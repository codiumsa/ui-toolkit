function ModelTrimmer(){function e(e,n){var o={},i=_.keys(e);return _.forEach(i,function(i){var r=_.findIndex(n,function(e){return e==i});return n&&-1!==r?(o[i]=e[i],void 0):(1==_.isArray(e[i])?(o[i]=[],_.forEach(e[i],function(r,a){t(e[i],o[i],a,n)})):t(e,o,i,n),void 0)}),o}function t(e,t,n){t[n]=_.isObject(e[n])&&e[n].hasOwnProperty("id")?e[n].id:e[n]}var n={trimDetails:e};return n}function NotificacionesWSFactory(e,t,n,o){function i(e){return g.query(e)}function r(e){var t=!1;e&&(t=e),h.close(t)}function a(e){return new g(e)}function s(e){return g.get({id:e})}function l(e,t){var n={action:"get",offset:e,limit:t};h.send(JSON.stringify(n))}function c(e){h=o(t.getBareServerUrl()+"wsnotificaciones");var n={action:"init",username:e};h.onOpen(function(){console.log("Socket abierto")}),h.onClose(function(){console.log("Socket cerrado")}),console.log(h),h.send(JSON.stringify(n))}function d(e,t){var o={action:e,notificacion:t.id};n.info("mensaje a mandar: "),n.info(o),h.send(JSON.stringify(o))}function u(e){h||(h=o(t.getBareServerUrl()+"wsnotificaciones")),h.onMessage(e)}function p(e){return e.$remove()}function f(e){return e.id?e.$update():e.$save()}var m={all:i,close:r,create:a,get:s,getLatest:l,init:c,remove:p,save:f,sendAction:d,registerMessageObserver:u},g=e(t.getBaseUrl()+"/notificaciones/:id",{id:"@id"},{update:{method:"PUT"}}),h=void 0;return m}function Util(){function e(e,t){for(var n=1,o=t;!o.esBase;)n*=o.cantidad,o=o.unidadContenida;return e*n}function t(e,t){for(var n=1,o=t;!o.esBase;)n*=o.cantidad,o=o.unidadContenida;return e/n}var n={toUnidadMedidaBase:e,fromUnidadMedidaBase:t};return n}!function(e){e.module("qualitaCoreFrontend.config",[]).value("qualitaCoreFrontend.config",{debug:!0}),e.module("qualitaCoreFrontend.directives",[]),e.module("qualitaCoreFrontend.filters",[]),e.module("qualitaCoreFrontend.services",[]),e.module("qualitaCoreFrontend",["qualitaCoreFrontend.config","qualitaCoreFrontend.directives","qualitaCoreFrontend.filters","qualitaCoreFrontend.services","ngResource","ngCookies","ngSanitize","ngTouch","datatables","datatables.bootstrap","schemaForm","pascalprecht.translate","cgNotify","angular-underscore/filters","flow","ui.bootstrap","ui.select","ui.highlight","ncy-angular-breadcrumb","ui.router","oc.lazyLoad","ngStorage","LocalForageModule","datatables.buttons","datatables.colreorder","daterangepicker","rangepicker","ngWebSocket","pickadate"])}(angular),angular.module("qualitaCoreFrontend").controller("BasicController",["$rootScope","$scope","formFactory","$location","$state","$injector",function(e,t,n,o,i,r){function a(){if(!n.canCreate(t.resources)){var e=r.get("notify");e({message:"No tiene permiso de creación",classes:["alert-danger"],position:"right"}),o.path("/")}t.title=t.newProperties.title,t.form=t.factory.form("new"),t.model={},t.schema.readonly=!1}function s(){if(!n.canEdit(t.resources)){var e=r.get("notify");e({message:"No tiene permiso de edición",classes:["alert-danger"],position:"right"}),o.path("/")}t.model=t.prepService,t.entidadId=t.model.id,t.entidad=t.editProperties.entidad,t.form=t.factory.form("edit"),t.title=t.editProperties.title,t.schema.readonly=!1}function l(){if(!n.canList(t.resources)){var e=r.get("notify");e({message:"No tiene permiso de vista",classes:["alert-danger"],position:"right"}),o.path("/")}t.options=n.defaultViewOptions(),t.model=t.prepService,t.entidadId=t.model.id,t.entidad=t.viewProperties.entidad,t.form=t.factory.form("view"),t.title=t.viewProperties.title,t.view=!0,t.schema.readonly=!0}t.activate=function(){t.schema=t.factory.schema(),t.options=n.defaultOptions(),i.is(t.newProperties.state)?a():i.is(t.editProperties.state)?s():i.is(t.viewProperties.state)&&l(),e.isProcessing=!1},t.submit=function(e){n.defaultSubmit(t.resource,t,e,t.factory)},t.cancel=function(){o.path("/"+t.resource)}}]),angular.module("qualitaCoreFrontend").directive("fileupload",["$rootScope","notify","UploadFactory","baseurl",function(e,t,n,o){return{template:'<div ng-show="uploadOptions.imageOnly"><div flow-init="{singleFile: true}" flow-files-submitted="uploader.flow.upload()"flow-file-added="!!{png:1,gif:1,jpg:1,jpeg:1}[$file.getExtension()]"flow-files-added="filesAdded($files, $event, uploader.flow)"flow-name="uploader.flow"class="ng-scope"><label>{{uploadOptions.title}}</label><div class="thumbnail" ng-show="uploader.currentFile && !uploader.flow.files.length"><img src="{{uploader.currentFile}}" style="max-width: 300px; max-height: 200px;"/> </div><div class="thumbnail" ng-show="!uploader.flow.files.length && !uploader.currentFile && !uploadOptions.imagePath"><img src="images/placeholder.png" style="max-width: 300px; max-height: 200px;"></div><div class="thumbnail" ng-show="uploader.flow.files.length"><img flow-img="uploader.flow.files[0]" style="max-width: 300px; max-height: 200px;"/> </div><div class="thumbnail" ng-show="uploadOptions.imagePath && !uploader.currentFile && !uploader.flow.files.length"><img ng-src="{{uploadOptions.imagePath}}" style="max-width: 300px; max-height: 200px;"/> </div><div><span class="btn btn-primary" ng-show="!uploader.flow.files.length" flow-btn="">Seleccionar imagen<input type="file" sf-changed="form" ng-model="$$value$$" style="visibility: hidden; position: absolute;" /></span><span class="btn btn-info ng-hide" ng-show="uploader.flow.files.length" flow-btn="">Cambiar<input type="file" sf-changed="form" ng-model="$$value$$" style="visibility: hidden; position: absolute;" /></span><span class="btn btn-danger ng-hide" ng-show="uploader.flow.files.length" ng-click="uploader.flow.cancel()">Eliminar</span></div><p>Formatos permitidos: PNG, GIF, JPG y JPEG.</p></div></div><div ng-show="!uploadOptions.imageOnly"><div flow-init flow-files-submitted="uploader.flow.upload()"flow-file-added="fileAdded($file, $event, $flow)" flow-files-added="filesAdded($files, $event, $flow)" flow-file-success="uploadCompleted()" class="ng-scope"><h3>{{uploadOptions.title}}</h3><div class="drop" flow-drop ng-class="dropClass"><span class="btn btn-default btn-sm" flow-btn>Cargar archivo <input type="file" ng-model="$$value$$" sf-changed="form" style="visibility: hidden; position: absolute;"/> </span> <br/> <b>O</b> Arrastre el archivo aqu&iacute; </div> <br/> <div ng-repeat="file in uploader.flow.files" class="transfer-box">{{file.relativePath}} ({{file.size}}bytes)<div class="progress progress-striped" ng-class="{active: file.isUploading()}"><div class="progress-bar" role="progressbar" aria-valuenow="{{file.progress() * 100}}" aria-valuemin="0" aria-valuemax="100" ng-style="{width: progressWith(file.progress())}"><span class="sr-only">{{file.progress()}}% Complete</span></div></div><div class="btn-group"><a class="btn btn-xs btn-danger" ng-click="file.cancel()">Cancelar</a><a class="btn btn-xs btn-info" ng-click="file.retry()" ng-show="file.error">Reintentar</a></div></div></div></div></div>',restrict:"E",tranclude:!0,scope:{uploadOptions:"="},link:function(e,i,r){e.uploader={},e.title=r.title,e.fileModel={},e.progressWith=function(e){return 100*e+"%"},e.filesAdded=function(t,n,o){e.uploader.flow=o,e.uploadOptions.flow=o},e.uploadOptions&&(e.uploader.flow=e.uploadOptions.flow),e.files=[],e.adjuntosBaseURL=o.getPublicBaseUrl(),e.fileAdded=function(n,o){if(e.uploadOptions.FILE_UPLOAD_LIMIT&&n.size>1e3*e.uploadOptions.FILE_UPLOAD_LIMIT*1e3)return o.preventDefault(),ngNotify.set("El tamaño del archivo supera el límite de "+e.uploadOptions.FILE_UPLOAD_LIMIT+" MB.","warn"),!1;var i=n.getExtension();return e.uploadOptions.imageOnly&&["png","gif","jpg","jpeg"].indexOf(i)<0?(t({message:"Solo se permiten archivos con extensión: png, gif, jpg o jpeg.",classes:"alert-warning",position:"right"}),!1):n.name.length>255?(t({message:"El nombre del archivo supera los 255 caracteres",classes:"alert-warning",position:"right"}),!1):void 0},e.uploadCompleted=function(){t({message:"Archivo cargado correctamente",classes:"alert-warning",position:"right"}),e.files=n.getCurrentFiles(e.uploadOptions)}}}}]),angular.module("qualitaCoreFrontend").directive("offlineFormRecovery",function(e){return{template:'<div class="btn-group" role="group" aria-label="First group"><button ng-disabled="!pending.length || position == 0" type="button" class="glyphicon glyphicon-arrow-left btn btn-default btn-recovery" ng-click="previous()"></button><button ng-disabled="!pending.length || position == pending.length" type="button" class="glyphicon glyphicon-arrow-right btn btn-default btn-recovery" ng-click="next()"></button><button ng-disabled="!pending.length || position == 0" type="button" class="glyphicon glyphicon-remove btn btn-default btn-recovery" ng-click="remove()"></button></div>',restrict:"EA",link:function(t){t.position=0,t.resource?e.getItem(t.resource).then(function(e){t.pending=_(e).filter(function(e){return!e.id}).map(function(e,t){return e.index=t,e}).value()}):console.log("scope.resource no definido"),t.next=function(){t.position++,t.model=0==t.position?{}:t.pending[t.position-1]},t.previous=function(){t.position--,t.model=0==t.position?{}:t.pending[t.position-1]},t.remove=function(){e.getItem(t.resource).then(function(n){t.pending=_.filter(n,function(e,n){return n!==t.position-1}),e.setItem(t.resource,t.pending),t.previous()})}}}}),angular.module("qualitaCoreFrontend").directive("reportViewer",["$modal","$sce",function(e,t){return{template:"",restrict:"E",scope:{url:"=",title:"@",background:"="},link:function(n,o){n.close=function(){n.modalInstance.dismiss("close")},n.$watch("url",function(){n.url&&(n.trustedUrl=t.trustAsResourceUrl(n.url),n.background?o.append('<iframe src="'+n.trustedUrl+'" hidden></iframe>'):n.modalInstance=e.open({template:'<div class="modal-header"><div class="close glyphicon glyphicon-remove" ng-click="close()"></div><h3 class="modal-title">{{title}}</h3></div><div class="modal-body"><iframe src="{{trustedUrl}}" width="100%" height="450"></iframe></div><div class="modal-footer"><button class="btn btn-primary" ng-click="close()">Cerrar</button></div>',scope:n}))})}}}]),angular.module("qualitaCoreFrontend").run(["$templateCache",function(e){e.put("views/directives/uiselect.html",'<div class="form-group"\n     ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess(), \'has-feedback\': form.feedback !== false}"\n     ng-init="selectedOptions=form.titleMap; insideModel=$$value$$;" ng-controller="dynamicSelectController">\n  <label class="control-label" ng-show="showTitle()">{{form.title}}</label>\n\n  <div class="form-group">\n    <ui-select ng-model="select_model.selected"\n               ng-if="!(form.options.tagging||false)" theme="bootstrap" ng-disabled="form.disabled"\n               on-select="$$value$$=$item.value" class="{{form.options.uiClass}}">\n      <ui-select-match\n        placeholder="{{form.placeholder || form.schema.placeholder || (\'\' | translate)}}">\n        {{select_model.selected.name}}\n      </ui-select-match>\n      <ui-select-choices refresh="populateTitleMap(form, form.options, $select.search)"\n                         refresh-delay="form.options.refreshDelay" group-by="form.options.groupBy"\n                         repeat="item in form.titleMap | filterRelated: {form: form} | propsFilter: {name: $select.search, description: (form.options.searchDescriptions===true ? $select.search : \'NOTSEARCHINGFORTHIS\') }">\n        <div ng-bind-html="item.name | highlight: $select.search"></div>\n        <div ng-if="item.description">\n          <span\n            ng-bind-html="\'<small>\' + (\'\'+item.description | highlight: (form.options.searchDescriptions===true ? $select.search : \'NOTSEARCHINGFORTHIS\'))+ \'</small>\'"></span>\n        </div>\n      </ui-select-choices>\n    </ui-select>\n    <ui-select ng-model="select_model.selected"\n               ng-if="(form.options.tagging||false) && !(form.options.groupBy || false)"\n               tagging="form.options.tagging||false" tagging-label="form.options.taggingLabel"\n               tagging-tokens="form.options.taggingTokens"\n               theme="bootstrap" ng-disabled="form.disabled" on-select="$$value$$=$item.value"\n               class="{{form.options.uiClass}}">\n      <ui-select-match\n        placeholder="{{form.placeholder || form.schema.placeholder || (\'\' | translate)}}">\n        {{select_model.selected.name}}&nbsp;\n        <small>{{(select_model.selected.isTag===true ? form.options.taggingLabel : \'\')}}</small>\n      </ui-select-match>\n      <!--repeat code because tagging does not display properly under group by but is still useful -->\n      <ui-select-choices refresh="populateTitleMap(form, form.options, $select.search)"\n                         refresh-delay="form.options.refreshDelay"\n                         repeat="item in form.titleMap | filterRelated: {form: form} | propsFilter: {name: $select.search, description: (form.options.searchDescription===true ? $select.search : \'NOTSEARCHINGFORTHIS\') }">\n        <div ng-if="item.isTag"\n             ng-bind-html="\'<div>\' + (item.name   | highlight: $select.search) + \' \' + form.options.taggingLabel + \'</div><div class=&quot;divider&quot;></div>\'"></div>\n        <div ng-if="!item.isTag" ng-bind-html="item.name + item.isTag| highlight: $select.search"></div>\n        <div ng-if="item.description">\n          <span\n            ng-bind-html="\'<small>\' + (\'\'+item.description | highlight: (form.options.searchDescriptions===true ? $select.search : \'NOTSEARCHINGFORTHIS\')) + \'</small>\'"></span>\n        </div>\n      </ui-select-choices>\n    </ui-select>\n\n    <!--repeat code because tagging does not display properly under group by but is still useful -->\n\n    <ui-select ng-model="select_model.selected"\n               ng-if="(form.options.tagging||false) && (form.options.groupBy || false)"\n               tagging="form.options.tagging||false" tagging-label="form.options.taggingLabel"\n               tagging-tokens="form.options.taggingTokens"\n               theme="bootstrap" ng-disabled="form.disabled" on-select="$$value$$=$item.value"\n               class="{{form.options.uiClass}}">\n      <ui-select-match\n        placeholder="{{form.placeholder || form.schema.placeholder || (\'\' | translate)}}">\n        {{select_model.selected.name}}&nbsp;\n        <small>{{(select_model.selected.isTag===true ? form.options.taggingLabel : \'\')}}</small>\n      </ui-select-match>\n      <ui-select-choices group-by="form.options.groupBy"\n                         refresh="populateTitleMap(form, form.options, $select.search)"\n                         refresh-delay="form.options.refreshDelay"\n                         repeat="item in form.titleMap | filterRelated: {form: form} | propsFilter: {name: $select.search, description: (form.options.searchDescription===true ? $select.search : \'NOTSEARCHINGFORTHIS\') }">\n        <div ng-if="item.isTag"\n             ng-bind-html="\'<div>\' + (item.name  | highlight: $select.search) + \' \' + form.options.taggingLabel + \'</div><div class=&quot;divider&quot;></div>\'"></div>\n        <div ng-if="!item.isTag" ng-bind-html="item.name + item.isTag| highlight: $select.search"></div>\n        <div ng-if="item.description">\n          <span\n            ng-bind-html="\'<small>\' + (\'\'+item.description | highlight: (form.options.searchDescriptions===true ? $select.search : \'NOTSEARCHINGFORTHIS\')) + \'</small>\'"></span>\n        </div>\n      </ui-select-choices>\n    </ui-select>\n    <input type="hidden" toggle-single-model sf-changed="form" ng-model="insideModel" schema-validate="form"/>\n    <span ng-if="form.feedback !== false"\n          class="form-control-feedback"\n          ng-class="evalInScope(form.feedback) || {\'glyphicon\': true, \'glyphicon-ok\': hasSuccess(), \'glyphicon-remove\': hasError() }"></span>\n\n    <div class="help-block"\n         ng-show="(hasError() && errorMessage(schemaError())) || form.description"\n         ng-bind-html="(hasError() && errorMessage(schemaError())) || form.description"></div>\n  </div>\n</div>\n'),e.put("ngTagsInput/tags-input.html",'<div class="host" tabindex="-1" ng-click="eventHandlers.host.click()" ti-transclude-append><div class="tags" ng-class="{focused: hasFocus}"><ul class="tag-list"><li class="tag-item" ng-repeat="tag in tagList.items track by track(tag)" ng-class="{ selected: tag == tagList.selected }" ng-click="eventHandlers.tag.click(tag)"><ti-tag-item data="::tag"></ti-tag-item></li></ul><input class="tag-input-text input" autocomplete="off" ng-model="newTag.text" ng-model-options="{getterSetter: true}" ng-keydown="eventHandlers.input.keydown($event)" ng-focus="eventHandlers.input.focus($event)" ng-blur="eventHandlers.input.blur($event)" ng-paste="eventHandlers.input.paste($event)" ng-trim="false" ng-class="{\'invalid-tag\': newTag.invalid}" ng-disabled="disabled" ti-bind-attrs="{type: options.type, tabindex: options.tabindex, spellcheck: options.spellcheck}" ti-autosize></div></div>'),e.put("ngTagsInput/tag-item.html",'<span ng-bind="$getDisplayText()"></span> <span class="remove-button close ui-select-match-close" ng-click="$removeTag()" ng-bind="::$$removeTagSymbol"></span>'),e.put("ngTagsInput/auto-complete.html",'<div class="autocomplete" ng-if="suggestionList.visible"><ul class="suggestion-list"><li class="suggestion-item" ng-repeat="item in suggestionList.items track by track(item)" ng-class="{selected: item == suggestionList.selected}" ng-click="addSuggestionByIndex($index)" ng-mouseenter="suggestionList.select($index)"><ti-autocomplete-match data="::item"></ti-autocomplete-match></li></ul></div>'),e.put("ngTagsInput/auto-complete-match.html",'<span ng-bind-html="$highlight($getDisplayText())"></span>'),e.put("bootstrap/select-multiple.tpl.html",'<div class="ui-select-container ui-select-multiple ui-select-bootstrap dropdown form-control" ng-class="{open: $select.open}"><div><div class="ui-select-match"></div><input type="search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="ui-select-search input-xs" placeholder="{{$selectMultiple.getPlaceholder()}}" ng-disabled="$select.disabled" ng-hide="$select.disabled" ng-click="$select.activate()" ng-model="$select.search" role="combobox" aria-label="{{ $select.baseTitle }}" ondrop="return false;"></div><div class="ui-select-choices"></div></div>'),e.put("bootstrap/select.tpl.html",'<div class="ui-select-container ui-select-bootstrap dropdown" ng-class="{open: $select.open}"><div class="ui-select-match"></div><input type="search" autocomplete="off" tabindex="-1" aria-expanded="true" aria-label="{{ $select.baseTitle }}" aria-owns="ui-select-choices-{{ $select.generatedId }}" aria-activedescendant="ui-select-choices-row-{{ $select.generatedId }}-{{ $select.activeIndex }}" class="form-control ui-select-search ui-select-search-single" placeholder="{{$select.placeholder}}" ng-model="$select.search" ng-show="$select.searchEnabled && $select.open"><div class="ui-select-choices"></div><div class="ui-select-no-choice"></div></div>')}]),angular.module("qualitaCoreFrontend").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,t,n){var o=function(t,o,i){if("string"===o.type&&"enum"in o){var r=e.stdFormObj(t,o,i);return r.key=i.path,r.type="strapselect",i.lookup[n.stringify(i.path)]=r,r}};e.defaults.string.unshift(o),t.addMapping("bootstrapDecorator","strapselect","views/directives/strapselect.html"),t.createDirective("strapselect","views/directives/strapselect.html"),t.addMapping("bootstrapDecorator","strapmultiselect","views/directives/strapmultiselect.html"),t.createDirective("strapmultiselect","views/directives/strapmultiselect.html"),t.addMapping("bootstrapDecorator","strapselectdynamic","views/directives/strapselect.html"),t.createDirective("strapselectdynamic","views/directives/strapselect.html"),t.addMapping("bootstrapDecorator","strapmultiselectdynamic","views/directives/strapmultiselect.html"),t.createDirective("strapmultiselectdynamic","views/directives/strapmultiselect.html"),t.addMapping("bootstrapDecorator","uiselect","views/directives/uiselect.html"),t.createDirective("uiselect","views/directives/uiselect.html"),t.addMapping("bootstrapDecorator","uiselectmultiple","views/directives/uiselectmultiple.html"),t.createDirective("uiselectmultiple","views/directives/uiselectmultiple.html")}]).directive("toggleSingleModel",function(){return{require:"ngModel",restrict:"A",scope:{},replace:!0,controller:["$scope",function(e){e.$parent.$watch("select_model.selected",function(){void 0!=e.$parent.select_model.selected&&(e.$parent.insideModel=e.$parent.select_model.selected.value,e.$parent.ngModel.$setViewValue(e.$parent.select_model.selected.value))})}]}}).directive("toggleModel",function(){return{require:"ngModel",restrict:"A",scope:{},controller:["$scope","sfSelect",function(e,t){var n=t(e.$parent.form.key,e.$parent.model);angular.isUndefined(n)&&(n=[],t(e.$parent.form.key,e.$parent.model,n)),e.$parent.$watch("form.selectedOptions",function(){e.$parent.form.selectedOptions&&(0==e.$parent.form.selectedOptions.length?void 0!=e.$parent.ngModel.$viewValue&&e.$parent.ngModel.$setViewValue(e.$parent.form.selectedOptions):(e.$parent.$$value$$=[],e.$parent.form.selectedOptions.forEach(function(t){e.$parent.$$value$$.push(t.value)}),e.$parent.ngModel.$setViewValue(e.$parent.$$value$$)))},!0)}]}}).directive("multipleOn",function(){return{link:function(e,t){e.$watch(function(){return t.attr("multiple-on")},function(e){if("true"==e){var n=angular.element(t).scope().$$childTail;n.$isMultiple=!0,n.options.multiple=!0,n.$select.$element.addClass("select-multiple")}else angular.element(t).scope().$$childTail.$isMultiple=!1})}}}).filter("whereMulti",function(){return function(e,t,n){var o=[];return angular.isArray(n)&&void 0!==e?n.forEach(function(n){for(var i=0;i<e.length;i++)if(n==e[i][t]){o.push(e[i]);break}}):o=e,o}}).filter("propsFilter",function(){return function(e,t){var n=[];return angular.isArray(e)?e.forEach(function(e){for(var o=!1,i=Object.keys(t),r=0;r<i.length;r++){var a=i[r];if(e&&e.hasOwnProperty(a)){var s=t[a].toLowerCase();if(e[a]&&(0===e[a].toString().toLowerCase().indexOf(s)||-1!==e[a].toString().toLowerCase().indexOf(" "+s))){o=!0;break}}}o&&n.push(e)}):n=e,n}}).filter("filterRelated",function(){return function(e,t){return"function"==typeof t.form.options.filterRelated?t.form.options.filterRelated(e):e}}),angular.module("qualitaCoreFrontend").controller("dynamicSelectController",["$scope","$http","$timeout",function(e,t,n){function o(t,n,o){var i=r(o),a=o.map;if(angular.isArray(i))return t;if(!i)return[{value:void 0,name:e.form.placeholder}].concat(t);for(var s=!1,l=0;l<t.length;l++)if(t[l][a.valueProperty]===i[a.valueProperty]){s=!0;break}var c=t[0];return t[0]=t[l],t[l]=c,s&&(e.select_model.selected=t[0]),t}function r(t){var n=e.form,o=n.key[0],i=angular.element("form[name="+t.formName+"]").scope();return i.model[o]}function a(t,n){var o=r(n);e.select_model.selected={value:o,name:o}}e.select_model={},e.triggerTitleMap=function(){console.log("listener triggered"),e.form.titleMap.push({value:"345890u340598u3405u9",name:"34095u3p4ouij"}),n(function(){e.form.titleMap.pop()})},e.initFiltering=function(t){e.form.options.filterTriggers&&e.form.options.filterTriggers.forEach(function(t){e.$parent.$watch(t,e.triggerTitleMap)}),e.localModelType=Object.prototype.toString.call(t),e.filteringInitialized=!0},e.remap=function(e,t){if(e&&"map"in e&&e.map){var n=[];if(t.forEach(function(t){t.value=t[e.map.valueProperty],t.name=t[e.map.nameProperty],n.push(t)}),e.formName){var i=angular.element("form[name="+e.formName+"]").scope();n=o(t,i,e)}return n}return t.forEach(function(e){"text"in e&&(e.name=e.text)}),t},e.clone=function(t){if(null==t||"object"!=typeof t)return t;var n=t.constructor();for(var o in t)t.hasOwnProperty(o)&&(n[o]=e.clone(t[o]));return n},e.getCallback=function(t){if("string"==typeof t){var n=e.$parent.evalExpr(t);if("function"==typeof n)return n;throw"A callback string must match name of a function in the parent scope"}if("function"==typeof t)return t;throw"A callback must either be a string matching the name of a function in the parent scope or a direct function reference"},e.getOptions=function(t){return t.httpPost&&t.httpPost.optionsCallback?(newOptionInstance=e.clone(t),e.getCallback(t.httpPost.optionsCallback)(newOptionInstance)):t.httpGet&&t.httpGet.optionsCallback?(newOptionInstance=e.clone(t),e.getCallback(t.httpGet.optionsCallback)(newOptionInstance)):t},e.test=function(e){e.titleMap.pop()},e.populateTitleMap=function(n){if("enum"in n.schema)n.titleMap=[],n.schema.enum.forEach(function(e){n.titleMap.push({value:e,name:e})}),a(n.titleMap,n.options);else if(n.options)if(n.options.callback)n.titleMap=e.getCallback(n.options.callback)(n.options),console.log("callback items",n.titleMap);else{if(n.options.asyncCallback)return e.getCallback(n.options.asyncCallback)(n.options).then(function(t){n.titleMap=e.remap(n.options,t.data),n.options.multiple&&e.uiMultiSelectInitInternalModel(r(n.options)),console.log("asyncCallback items",n.titleMap)},function(e,t){alert("Loading select items failed(Options: '"+String(n.options)+"\nError: "+t)});if(n.options.httpPost){var o=e.getOptions(n.options);return t.post(o.httpPost.url,o.httpPost.parameter).then(function(t){n.titleMap=e.remap(o,t.data),console.log("httpPost items",n.titleMap)},function(e,t){alert("Loading select items failed (URL: '"+String(o.httpPost.url)+"' Parameter: "+String(o.httpPost.parameter)+"\nError: "+t)})}if(n.options.httpGet){var o=e.getOptions(n.options);return t.get(o.httpGet.url,o.httpGet.parameter).then(function(t){n.titleMap=e.remap(o,t.data),console.log("httpGet items",n.titleMap)},function(e,t){alert("Loading select items failed (URL: '"+String(o.httpGet.url)+"\nError: "+t)})}}else console.log("dynamicSelectController.populateTitleMap(key:"+n.key+") : No options set, needed for dynamic selects")},e.uiMultiSelectInitInternalModel=function(t){function n(t){for(i=0;i<e.form.titleMap.length;i++)if(e.form.titleMap[i].value==t)return e.form.titleMap[i].name}e.internalModel=[],void 0!==t&&angular.isArray(t)&&t.forEach(function(t){e.internalModel.push({value:t,name:n(t)})})}}]),angular.module("qualitaCoreFrontend").filter("selectFilter",[function(){return function(e,t,n,o){if(!angular.isDefined(e)||!angular.isDefined(t.form.options)||!angular.isDefined(t.form.options.filter)||""==t.form.options.filter)return e;console.log("----- In filtering for "+t.form.key+"("+t.form.title+"), model value: "+JSON.stringify(n)+"----"),console.log("Filter:"+t.form.options.filter),t.filteringInitialized||(console.log("Initialize filter"),t.initFiltering(n));var i=[];return angular.forEach(e,function(e){console.log("Compare: curr_item: "+JSON.stringify(e)+"with : "+JSON.stringify(t.$eval(t.form.options.filterTriggers[0]))),t.$eval(t.form.options.filter,{item:e})?i.push(e):n&&("[object Array]"==t.localModelType&&n.indexOf(e.value)>-1?n.splice(n.indexOf(e.value),1):n==e.value&&(console.log("Setting model of type "+t.localModelType+"to null."),n=null))}),"[object Array]"!=t.localModelType||n||(console.log("Resetting model of type "+t.localModelType+" to []."),t.$eval(o+"=[]")),console.log("Input: "+JSON.stringify(e)),console.log("Output: "+JSON.stringify(i)),console.log("Model value out : "+JSON.stringify(n)),console.log("----- Exiting filter for "+t.form.title+"-----"),i}}]),angular.module("qualitaCoreFrontend").directive("tdnDatatable",function(e,t,n,o,i,r,a,s,l,c){var d=r.hasPermission;return{template:'<div><div class="widget"><div class="widget-header bordered-top bordered-palegreen" ng-if="!options.hideHeader"><span class="widget-caption">{{options.title}}</span><div class="widget-buttons"><a href="" ng-show="canCreate()" ng-click="new()" title="Nuevo"><i class="glyphicon glyphicon-plus"></i></a><a ng-repeat="menuOption in options.extraMenuOptions" href="" ng-show="menuOption.showCondition()" ng-click="menuOption.action()" title="{{menuOption.title}}"><p><i class="{{menuOption.icon}}"></i>  {{menuOption.data}}&nbsp;&nbsp;&nbsp;</p></a></div></div><div class="widget-body"><div class="table-responsive"><table datatable="" dt-options="dtOptions" dt-columns="dtColumns" dt-instance="dtInstanceCallback" width=100% class="table table-hover table-responsive table-condensed no-footer"></table></div><div ng-if="selected"><h3>Detalles</h3><table class="table table-striped table-bordered table-detail"><tbody><tr ng-repeat="row in options.detailRows"><td ng-if="selected[row.data]" class="row-title">{{row.title}}</td><td ng-if="selected[row.data] && row.renderWith">{{row.renderWith(selected[row.data])}}</td><td ng-if="selected[row.data] && !row.renderWith">{{selected[row.data]}}</td></tr></tbody></table></div></div></div>',restrict:"AE",replace:!0,scope:{options:"="},controller:function(r){function u(){g=r.options.staticFilter?_.template(l.getBaseUrl()+"/<%= resource %>/datatables?search="+encodeURI(JSON.stringify(r.options.staticFilter.search))+"&"):_.template(l.getBaseUrl()+"/<%= resource %>/datatables?")}function p(t,n){return $("td",t).unbind("click"),$("td",t).bind("click",function(){r.$apply(function(){r.selected=n,e(function(){$(document).scrollTop($(".table-detail").offset().top)})})}),t}var f,m,g;u(),r.dtInstance={},r.selectAll=!1,r.options.selection={},r.headerCompiled=!1,r.customFilters={};var h,v,b="~",y="DD/MM/YYYY",w="string",O=function(e,t){h&&(r.options.tableAjaxParams=h.ajax.params(),_.forEach(h.colReorder.order(),function(t,n){e.columns[n].type=r.customFilters[t]?r.customFilters[t].filterType:w})),e.rangeSeparator=b;var n=i(g(r.options)+$.param(e),{},{query:{isArray:!1}});n.query().$promise.then(function(e){var n=e.data;n&&n.forEach(function(e){Object.keys(e).forEach(function(t){e[t]===!0?e[t]="Sí":e[t]===!1&&(e[t]="No")})}),t(e)}).catch(function(e){console.log(e),console.log("error")})},k=r.options.ajax?r.options.ajax:O;r.dateRangeFilters={i:{startDate:null,endDate:null}};var C=function(e){var t=e.model.startDate.format(y),n=e.model.endDate.format(y),o=h.colReorder.order().indexOf(e.opts.index);h.column(o).search(t+b+n).draw()},x=function(e){var t=h.colReorder.order().indexOf(e.opts.index);h.column(t).search("").draw(),$("#daterange_"+e.opts.index).val(""),r.dateRangeFilters[e.opts.index].startDate=null,r.dateRangeFilters[e.opts.index].endDate=null},S=function(e){if(null===r.dateRangeFilters[e.opts.index].startDate){var t=r.dateRangePickerWidgetsOrder.indexOf(e.opts.index),n=$($(".daterangepicker").get(t));n.parent().find(".in-range").removeClass("in-range"),n.parent().find(".active").removeClass("active"),n.parent().find(".input-mini").removeClass("active").val("")}};moment.locale("es");var F={cancelLabel:"Limpiar",applyLabel:"Aplicar",format:y,separator:" a ",weekLabel:"S",daysOfWeek:moment.weekdaysMin(),monthNames:moment.monthsShort(),firstDay:moment.localeData().firstDayOfWeek()};r.dateRangeOptions={};var T={eventHandlers:{"apply.daterangepicker":C,"cancel.daterangepicker":x,"show.daterangepicker":S},opens:"right",index:0,showDropdowns:!0,locale:F};r.dateRangePickerWidgetsOrder=[],r.numberRangeFilters={i:{startRange:null,endRange:null}};var R=function(e){var t=e.model.startRange,n=e.model.endRange,o=h.colReorder.order().indexOf(e.opts.index);h.column(o).search(t+b+n).draw()},M=function(e){var t=h.colReorder.order().indexOf(e.opts.index);h.column(t).search("").draw(),$("#numberrange_"+e.opts.index).val(""),r.numberRangeFilters[e.opts.index].startRange=null,r.numberRangeFilters[e.opts.index].endRange=null;var n=r.rangePickerWidgetsOrder.indexOf(e.opts.index),o=$($(".rangepicker").get(n));o.parent().find("input[name=rangepicker_start]").val(),o.parent().find("input[name=rangepicker_end]").val()},A={cancelLabel:"Limpiar",applyLabel:"Aplicar",separator:" a "};r.rangeOptions={};var I={eventHandlers:{"apply.rangepicker":R,"cancel.rangepicker":M},opens:"right",index:0,showDropdowns:!0,locale:A};r.rangePickerWidgetsOrder=[],r.dtOptions=a.newOptions().withOption("ajax",k).withDataProp("data").withOption("processing",!0).withOption("serverSide",!0).withOption("language",{sProcessing:"Procesando...",sLengthMenu:"Registros _MENU_",sZeroRecords:"No se encontraron resultados",sEmptyTable:"Ningún dato disponible en esta tabla",sInfo:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",sInfoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",sInfoFiltered:"(filtrado de un total de _MAX_ registros)",sInfoPostFix:".",sSearch:"Buscar:",sInfoThousands:",",sLoadingRecords:"Cargando...",oPaginate:{sFirst:"Primero",sLast:"Último",sNext:"Siguiente",sPrevious:"Anterior"},oAria:{sSortAscending:": Activar para ordenar la columna de manera ascendente",sSortDescending:": Activar para ordenar la columna de manera descendente"}}).withOption("createdRow",function(e){n(angular.element(e).contents())(r)
}).withOption("headerCallback",function(e){r.headerCompiled||(r.headerCompiled=!0,n(angular.element(e).contents())(r))}).withPaginationType("full_numbers").withButtons(["colvis"]).withBootstrap(),r.options.detailRows&&(r.dtOptions=r.dtOptions.withOption("rowCallback",p)),r.visibleColumns=0,r.dtColumns=[],r.defaultColumnOrderIndices=[],r.originalIndexKey={};var P=0;if(r.options.isSelectable){var E='<label><input type="checkbox" ng-model="selectAll" ng-click="toggleAll()"><span class="text"></span></label>';m=s.newColumn(null).withTitle(E).notSortable().withOption("searchable",!1).renderWith(function(e){var t='<label><input id="'+e.id+'" type="checkbox" ng-model="options.selection['+e.id+']" ng-click="toggleOne()"><span class="text"></span></label>';return t}).withOption("name","checkbox"),r.dtColumns.push(m),r.visibleColumns+=1,P=1,r.originalIndexKey[0]=null,r.defaultColumnOrderIndices.push(0),r.dtOptions.withColReorderOption("iFixedColumnsLeft",1)}var D=["data","title","class","renderWith","visible","sortable","searchable"];_.map(r.options.columns,function(e,t){var n=s.newColumn(e.data),o=P+t;if(r.originalIndexKey[o]=e.data,e.title&&(n=n.withTitle(e.title)),e.class&&(n=n.withClass(e.class)),e.renderWith&&(n=n.renderWith(e.renderWith)),e.sortable===!1&&(n=n.notSortable()),_.contains(r.options.defaultColumnOrder,e.data)&&e.visible!==!1?r.visibleColumns+=1:n=n.notVisible(),_.forOwn(e,function(e,t){_.contains(D,t)||(n=n.withOption(t,e))}),n=e.searchable===!1?n.withOption("bSearchable",!1):n.withOption("bSearchable",!0),e.type){var i={filterType:e.type,filterUrl:e.filterUrl};"date-range"===e.type?r.dateRangeFilters[o]={startDate:null,endDate:null}:"number-range"===e.type&&(r.numberRangeFilters[o]={startRange:null,endRange:null}),r.customFilters[o]=i}r.dtColumns.push(n)}),r.options.hasOptions&&(r.originalIndexKey[r.visibleColumns]=null,r.dtOptions.withColReorderOption("iFixedColumnsRight",1),r.visibleColumns+=1),(r.options.colReorder===!0||void 0===r.options.colReorder)&&r.dtOptions.withColReorder(),f=s.newColumn(null).withTitle("Operaciones").notSortable().withOption("searchable",!1).renderWith(function(e){var t='<button class="btn-row-datatable btn btn-success btn-dt" style="margin-right: 5px;" ng-class="{ hidden : !canEdit('+e.id+')}" ng-click="edit('+e.id+')">   <span class="glyphicon glyphicon-pencil"></span></button><button class="btn-row-datatable btn btn-danger btn-dt" style="margin-right: 5px;" ng-class="{ hidden : !canRemove('+e.id+')}" ng-click="remove('+e.id+')">   <span class="glyphicon glyphicon-trash"></span></button><button class="btn-row-datatable btn btn-info btn-dt" style="margin-right: 5px;" ng-class="{ hidden : !canList('+e.id+')}" ng-click="view('+e.id+')">   <span class="glyphicon glyphicon-eye-open"></span></button>';return r.options.extraRowOptions&&_.forEach(r.options.extraRowOptions,function(n){var i=_.template(n.templateToRender);r[n.functionName]=n.functionDef,t+=i({dataCustom:JSON.stringify(e[n.customAttribute]),dataId:e.id,$state:o,$scope:r}),r[n.conditionName]=n.conditionDef}),t}),r.canEdit=function(e){var t=d("update_"+r.options.resource);if(r.options.extraEditConditions){var n=_.find(h.rows().data(),function(t){return t.id==e});return t&&r.options.extraEditConditions(n)&&!r.options.hideEditMenu}return t&&!r.options.hideEditMenu},r.canRemove=function(e){var t=d("delete_"+r.options.resource);if(r.options.extraRemoveConditions){var n=_.find(h.rows().data(),function(t){return t.id==e});return t&&r.options.extraRemoveConditions(n)&&!r.options.hideRemoveMenu}return t&&!r.options.hideRemoveMenu},r.canCreate=function(){var e=d("create_"+r.options.resource);return e&&!r.options.hideAddMenu},r.canList=function(e){var t=d("index_"+r.options.resource);if(r.options.extraViewConditions){var n=_.find(h.rows().data(),function(t){return t.id==e});return t&&r.options.extraViewConditions(n)&&!r.options.hideViewMenu}return t&&!r.options.hideViewMenu},r.options.hasOptions&&(r.dtColumns.push(f),r.visibleColumns+=1),r.new=function(){var e=_.template("app.<%= resource %>.new");o.go(e(r.options),{})},r.edit=function(e){var t=_.template("app.<%= resource %>.edit");o.go(t(r.options),{id:e})},r.view=function(e){var t=_.template("app.<%= resource %>.view");o.go(t(r.options),{id:e})},r.toggleAll=function(){r.selectAll?_.each(h.rows().data(),function(e){r.options.selection[e.id]=!0}):_.each(h.rows().data(),function(e){r.options.selection[e.id]=!1})},r.toggleOne=function(){var e=_.some(h.rows().data(),function(e){return!r.options.selection[e.id]});r.selectAll=!e};var U=function(e){return e.descripcion},N=function(e){return""===e.descripcion?'<div class="select2-user-result">Todos</div>':'<div class="select2-user-result">'+e.descripcion+"</div>"},q=function(){$("#"+v+" tfoot tr").empty(),r.dateRangePickerWidgetsOrder=[],$(".daterangepicker").remove(),r.options.currentColumnOrder=[],_.forEach(h.context[0].aoColumns,function(e){var t=e._ColReorder_iOrigCol,o=e.mData,i="<th></th>";if(e.bVisible){o&&r.options.currentColumnOrder.push(o);var a=e.name;name||(a=e.sTitle);var s=r.customFilters[t];if(s){if("combo"===s.filterType){var d="combo_"+t;i='<th><div id="'+d+'" name="'+a+'" class="filtro-ancho"></div></th>',$("#"+v+" tfoot tr").append(i),i="",$("#"+d).select2({minimumResultsForSearch:-1,id:function(e){return e.descripcion},data:function(){return $http({url:l.getBaseUrl()+s.filterUrl,method:"GET"})},ajax:{url:l.getBaseUrl()+"/"+s.filterUrl,dataType:"json",quietMillis:250,params:{headers:{Authorization:c.AuthParams.accessToken}},data:function(e){return{q:e}},results:function(e){return{results:e}},cache:!0},initSelection:function(t,n){h.column(e.idx).search();$.ajax(l.getBaseUrl()+"/"+s.filterUrl,{dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization",c.AuthParams.accessToken)}}).done(function(e){n(e)})},formatResult:N,formatSelection:U,escapeMarkup:function(e){return e}}).on("change",function(){var e=($("#"+d).select2("val"),parseInt(d.substring(6))),t=h.colReorder.order().indexOf(e);this.value.length>=1?h.column(t).search(this.value).draw():h.column(t).search("").draw()})}else if("date-range"===s.filterType){r.dateRangeOptions[t]=_.clone(T,!0),r.dateRangeOptions[t].index=t,t>r.options.columns.length/2&&(r.dateRangeOptions[t].opens="left"),r.dateRangePickerWidgetsOrder.push[t];var u='<th><input id="daterange_'+t+'" date-range-picker class="column-filter form-control input-sm date-picker" options="dateRangeOptions['+t+']" type="text" ng-model="dateRangeFilters['+t+']" /></th>';i=n(u)(r)}else if("number-range"===s.filterType){r.rangeOptions[t]=_.clone(I,!0),r.rangeOptions[t].index=t,t>r.options.columns.length/2&&(r.rangeOptions[t].opens="left"),r.rangePickerWidgetsOrder.push[t];var u='<th><input  id="numberrange_'+t+'" range-picker class="column-filter form-control input-sm " options="rangeOptions['+t+']" type="text" ng-model="numberRangeFilters['+t+']" /></th>';i=n(u)(r)}}else if(e.mData&&e.bSearchable){var p=h.column(e.idx).search();i='<th><input id="filtro_'+t+'" class="column-filter form-control input-sm" type="text" style="min-width:60px; width: 100%;" value="'+p+'"/></th>'}else i="<th></th>";$("#"+v+" tfoot tr").append(i)}n($(".btn-row-datatable"))(r)}),_.forEach($("[id^='filtro']"),function(e){$(e).on("keyup change",function(t){var n=parseInt(e.id.substring(7)),o=h.colReorder.order().indexOf(n);(this.value.length>=1||13==t.keyCode)&&h.column(o).search(this.value).draw(),""==this.value&&h.column(o).search("").draw()})})};r.dtInstanceCallback=function(t){$("thead+tfoot").remove(),v=t.id,h=t.DataTable,$("#"+v).append("<tfoot><tr></tr></tfoot>"),q(),$("#"+v+" tfoot").insertAfter("#"+v+" thead"),_.each(r.dtColumns,function(e,t){if(e.filter){var n=$(".input-sm")[t+1];n.value=e.filter}}),$(".dt-button.buttons-colvis").removeClass().addClass("columns-selection").html('<i class="glyphicon glyphicon-th-list"></i>'),r.options.reloadData=function(){u(),$("#"+v).DataTable().ajax.reload()},r.$watch("options.staticFilter",function(){u(),$("#"+v).DataTable().ajax.reload()}),h.on("draw",function(){e(function(){if(h.rows().data().length>0){var e=!0;_.each(h.rows().data(),function(t){void 0===r.options.selection[t.id]?(r.options.selection[t.id]=!1,e=!1):0==r.options.selection[t.id]&&(e=!1)}),r.selectAll=e}else r.selectAll=!1})}),h.on("column-visibility",function(){q()}),h.on("column-reorder",function(){q()}),r.dtInstance=t,r.options.getFilters=function(){var e={};return _.forEach(h.context[0].aoColumns,function(t){var n=t._ColReorder_iOrigCol,o=t.mData;void 0!==o&&""!==o&&null!==o&&(e[o]=h.column(n).search())}),e},void 0!==r.options.defaultOrderColumn&&void 0!==r.options.defaultOrderDir&&h.order([[r.options.defaultOrderColumn,r.options.defaultOrderDir]])},r.remove=function(e){r.disableButton=!1,r.selectedItemId=e,r.tituloModal="Confirmación de Borrado",r.mensajeModal="Esta operación eliminará el registro seleccionado. ¿Desea continuar?",r.modalInstanceBorrar1=t.open({template:'<div class="modal-header"><h3 class="modal-title">{{::tituloModal}}</h3></div><div class="modal-body">{{::mensajeModal}}</div><div class="modal-footer"><button class="btn btn-primary" ng-disabled="disableButton" ng-click="ok(selectedItemId)">Aceptar</button><button class="btn btn-warning" ng-disabled="disableButton" ng-click="cancel()">Cancelar</button></div>',scope:r}),r.cancel=function(){r.disableButton=!0,r.modalInstanceBorrar1.dismiss("cancel")},r.ok=function(e){r.disableButton=!0;var n=r.options.factory.create({id:e});r.options.factory.remove(n).then(function(){$("#"+v).DataTable().ajax.reload(),r.modalInstanceBorrar1.close(e)},function(e){r.modalInstanceBorrar1.dismiss("cancel"),r.tituloModal="No se pudo borrar el registro",r.mensajeModal=r.options.failedDeleteError;var n=t.open({template:'<div class="modal-header"><h3 class="modal-title">{{::tituloModal}}</h3></div><div class="modal-body">{{::mensajeModal}}</div><div class="modal-footer"><button class="btn btn-primary" ng-click="cancel()">Aceptar</button></div>',scope:r});r.cancel=function(){n.dismiss("cancel")},console.log("error al borrar: "),console.log(e)})}},r.options.detailRows&&(r.options.detailRows=r.options.detailRows===!0?r.options.columns:_.union(r.options.columns,r.options.detailRows))}}}),angular.module("qualitaCoreFrontend").service("AuthenticationService",function(e,t,n,o){var i=e(o.getBaseUrl()+"/:action",{action:"@action"});return{login:function(e,n){t.auxiliarUsername=e;var o=new i({username:e,password:n});return o.$save({action:"login"})},postLogin:function(e){return new i.save({action:"loginApp"},{username:e.username})},token:function(e){var t=new i({username:e.username,accessToken:e.accessToken,requestToken:e.requestToken});return t.$save({action:"token"})},logout:function(){var e=this.getCurrentUser(),n=new i({username:e.username,accessToken:e.accessToken});return t.AuthParams={},localStorage.removeItem("AUTH_PARAMS"),n.$save({action:"logout"})},getCurrentUser:function(){var e=t.AuthParams;return e&&0!==Object.keys(e).length||(e=JSON.parse(localStorage.getItem("AUTH_PARAMS"))||void 0,e&&(n.defaults.headers.common.Authorization="Bearer "+e.accessToken)),e}}}),angular.module("qualitaCoreFrontend").service("AuthorizationService",function(e,t,n,o,i){var r=t(o.getBaseUrl()+"/authorization/:action",{action:"@action"});return{hasPermission:function(e,t){var n=t||i.getCurrentUser(),o=[];return n&&(o=n.permissions||[]),o.indexOf(e)>=0},principal:function(){return r.get({action:"principal"}).$promise},setupCredentials:function(t,o,i,r){var a={username:t,requestToken:o,accessToken:i};e.AuthParams=a,localStorage.setItem("AUTH_PARAMS",JSON.stringify(a)),n.defaults.headers.common.Authorization="Bearer "+i,this.principal().then(function(e){a.permissions=e.permisos,a.stamp=e.stamp,localStorage.setItem("AUTH_PARAMS",JSON.stringify(a)),r(a)})},cleanupCredentials:function(){localStorage.removeItem("AUTH_PARAMS")},authorize:function(e,t){var n=i.getCurrentUser();if(e===!0&&void 0===n)return this.enums.LOGIN_REQUIRED;if(e&&void 0!==n&&(void 0===t||0===t.length))return this.enums.AUTHORIZED;if(t){for(var o=!0,r=0;r<t.length&&(o=this.hasPermission(t[r],n),o!==!1);r++);return o?this.enums.AUTHORIZED:this.enums.NOT_AUTHORIZED}},enums:{LOGIN_REQUIRED:"loginRequired",NOT_AUTHORIZED:"notAuthorized",AUTHORIZED:"authorized"}}}),angular.module("qualitaCoreFrontend").provider("baseurl",function(){this.config={},this.setConfig=function(e){this.config=e},this.$get=function(){var e=this.config;return{getBaseUrl:function(){var t=window.location.hostname;return t===e.serverIp?"http://"+t+"/"+e.serverName+"/"+e.serverAPI:"http://"+t+":"+e.serverPort+"/"+e.serverName+"/"+e.serverAPI},getPublicBaseUrl:function(){var t=window.location.hostname;return t===e.serverIp?"http://"+t+"/public/":"http://"+t+":"+e.serverPort+"/public/"},getBareServerUrl:function(){var t=window.location.hostname;return t===e.serverIp?"ws://"+t+"/"+e.serverWSName+"/":"ws://"+t+":"+e.serverPort+"/"+e.serverName+"/"}}}}),angular.module("qualitaCoreFrontend").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider","flowFactoryProvider",function(e,t,n,o){o.defaults={method:"octet"};var i=function(t,o,i){if("object"===o.type&&"fileupload"===o.format){var r=e.stdFormObj(t,o,i);return r.key=i.path,r.type="fileupload",i.lookup[n.stringify(i.path)]=r,r}};e.defaults.object.unshift(i),t.addMapping("bootstrapDecorator","fileupload","views/directives/fileupload.html"),t.createDirective("fileupload","views/directives/fileupload.html")}]).factory("fileupload",function(){}),angular.module("qualitaCoreFrontend").factory("filterFactory",function(){var e=function(e,t){var i={_inner:{type:e}};return t.constructor!==Array&&(t=[t]),i._inner.filters=this&&this._inner?[this._inner,t]:t,i.or||"and"!==e||(i.or=n),i.value||(i.value=r),i.add||(i.add=o),i.paginate=a,i},t=function(t){return e.call(this,"and",t)},n=function(t){return e.call(this,"or",t)},o=function(e){return this._inner.filters.push(e),this},i=function(e){return t([e])},r=function(){return this._inner},a=function(e,t){return this._inner.limit=e,this._inner.offset=t,this};return{and:t,or:n,add:o,single:i,value:r}}),angular.module("qualitaCoreFrontend").factory("formFactory",function(e,t,n,o,i,r){var a=i.hasPermission;return{defaultForm:function(){return["*",{type:"submit",title:"Guardar",htmlClass:"pull-right"}]},defaultOptions:function(){return{formDefaults:{ngModelOptions:{updateOn:"blur"},disabled:!1,disableSuccessState:!1,disableErrorState:!1,feedback:!0},validationMessage:{302:"El campo es obligatorio"}}},defaultViewOptions:function(){return{formDefaults:{disabled:!0,disableSuccessState:!0,disableErrorState:!0,feedback:!1}}},defaultSubmit:function(i,r,a,s,l,c){var d=[];if(_.each(a.$error,function(e,t){_.contains(r.schema.backEndValidatedErrors,t)&&_.each(e,function(e){var n="schemaForm.error."+e.$name;d.push(n),console.log("schemaForm.error."+e.$name+" error: "+t),r.$broadcast(n,t.toString(),!0,!0)}),_.each(d,function(e,t){console.log(e+" error: "+t),r.$broadcast(e,"schemaForm",!0,!0)})}),r.$broadcast("schemaFormValidate"),a.$valid&&!o.isProcessing){if(o.isProcessing=!0,r.model)var u=s.create(r.model);else var u=s.create(l.model);if(r.schema)var p=r.schema;else var p=l.schema;_.each(p.properties,function(e,t){!e.format||"date"!==e.format&&"date-time"!==e.format||u[t]&&"string"==typeof u[t]&&(u[t]=new moment(u[t],e.formatDate||"DD/MM/YYYY").toDate())}),s.save(u).then(function(){e.path("/"+i)}).catch(function(e){if(console.log(e),o.isProcessing=!1,c)return c(e),void 0;if(r.schema)var a=r.schema;else var a=l.schema;if(_.each(a.properties,function(e,t){!e.format||"date"!==e.format&&"date-time"!==e.format||r.model[t]&&r.model[t]instanceof Date&&(r.model[t]=currentForm[t].$viewValue)}),e.constructor===Array&&e.data[0].constraint&&r.$broadcast("schemaForm.error."+e.data[0].constraint,e.data[0].codigoError.toString(),!1),e.data&&403!==e.data.code){var s="Error al persistir la operación.";r.model.id||(s+="\n\nGuardando localmente, reintente más tarde."),n({message:s,classes:"alert-danger",position:"right"}),t.getItem(i).then(function(e){e=e||[],e.unshift(r.model),r.model.id||t.setItem(i,e)})}else if(e&&500===e.status){var s="";_.forEach(e.data,function(e){s+="\n\n"+e.message+"."}),n({message:s,classes:"alert-danger",position:"right"}),deferred.reject(s)}})}},defaultNSFSubmit:function(e,t,i,a){var s=r.defer();if(e.$valid&&!o.isProcessing){o.isProcessing=!0;var l=t.create(i);t.save(l).then(function(e){s.resolve(e)}).catch(function(e){if(console.log(e),o.isProcessing=!1,a)a(e),s.reject(t);else if(e&&500===e.status){var t="";_.forEach(e.data,function(e){t+="\n\n"+e.message+"."}),n({message:t,classes:"alert-danger",position:"right"}),s.reject(t)}})}return s.promise},canEdit:function(e){var t=a("update_"+e);return t},canList:function(e){var t=a("index_"+e);return t},canRemove:function(e){var t=a("delete_"+e);return t},canCreate:function(e){var t=a("create_"+e);return t}}}),angular.module("qualitaCoreFrontend").factory("HttpInterceptor",function(e,t,n,o,i){return{request:function(e){return"/login"!==t.path()&&(e.headers.Authorization="Bearer "+n.AuthParams.accessToken),e},requestError:function(n){return 401===n.status&&t.path("/login"),e.reject(n)},response:function(e){return e},responseError:function(o){console.log("responseError 401");var r=i.get("notify");if(401===o.status){if(o.data&&403===o.data.code)return r({message:o.data.error,classes:["alert-danger"],position:"right"}),t.path("/"),e.reject(o);if("/login"===t.path())return e.reject(o);var a=e.defer(),s=i.get("AuthenticationService"),l=i.get("$http"),c=s.token(n.AuthParams);return c.then(function(e){n.AuthParams.accessToken=e.accessToken,localStorage.setItem("AUTH_PARAMS",JSON.stringify(n.AuthParams)),l.defaults.headers.common.Authorization="Bearer "+e.accessToken,s.postLogin(n.AuthParams).$promise.then(function(e){n.AuthParams.accesoSistema=e,console.log("se ejecutó el response error"),l.defaults.headers.common["X-Access"]=n.AuthParams.accesoSistema.accesosSistema[0].locacion.id})}).then(a.resolve,a.reject),a.promise.then(function(){return o.config.headers.Authorization="Bearer "+n.AuthParams.accessToken,l(o.config)})}return e.reject(o)}}}),angular.module("qualitaCoreFrontend").factory("ModelTrimmer",ModelTrimmer),angular.module("qualitaCoreFrontend").factory("NotificacionesWSFactory",NotificacionesWSFactory),NotificacionesWSFactory.$inject=["$resource","baseurl","$log","$websocket"],angular.module("qualitaCoreFrontend").factory("ReportTicketFactory",["$resource","baseurl",function(e,t){var n=e(t.getBaseUrl()+"/ticket/:reportID?:query&currentColumnOrder=:currentColumnOrder",{action:"@reportID"});return{ticket:function(e,t,o,i){var r=new n(t),a={reportID:e};return o&&(a.query=decodeURIComponent($.param(o))),i&&(a.currentColumnOrder=i),r.$save(a)},downloadURL:function(e,n){return console.log("downloadURL"),t.getBaseUrl()+"/generar/"+e+"/"+n}}}]),angular.module("qualitaCoreFrontend").service("UploadFactory",["$rootScope","baseurl",function(e,t){function n(e){o=e.flow}var o,i={jpg:"image/jpg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif"};return{getCurrentFiles:function(e){var t=this;if(n(e),o){var i=o.files,r=[];return i.length>0&&angular.forEach(i,function(e){r.push({path:t.getFilename(e)})}),r}},clearCurrentFiles:function(){e.flow.files=[]},addFiles:function(e){n(),o&&angular.forEach(e,function(e){var n=i[e.path.toLowerCase().substring(_.lastIndexOf(e.path,".")+1)],r=new Blob(["pre_existing_image"],{type:n});r.name=e.path,r.image_url=t.getPublicBaseUrl()+e.path;var a=new Flow.FlowFile(o,r);a.fromServer=!0,o.files.push(a)})},getFilename:function(e){if(e.fromServer)return e.name;var t=e.size+"-"+e.name;return t=t.replace(/[^a-zA-Z\/-_\\.0-9]+/g,""),t=t.replace(/\s/g,"")}}}]),angular.module("qualitaCoreFrontend").factory("usuariosFactory",function(e,t,n){var o=e(n.getBaseUrl()+"/usuarios/:id",{id:"@id"},{update:{method:"PUT"}});return{all:function(e){return o.query(e)},get:function(e){return o.get({id:e})},getByUsername:function(e){var n={};return n.search=t.single({path:"username",equals:e}).value(),o.query(n)},create:function(e){return new o(e)},save:function(e){return e.id?e.$update():e.$save()},remove:function(e){return e.$remove()}}}),angular.module("qualitaCoreFrontend").factory("Util",Util);