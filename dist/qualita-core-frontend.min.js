!function(e){e.module("qualitaCoreFrontend.config",[]).value("qualitaCoreFrontend.config",{debug:!0}),e.module("qualitaCoreFrontend.directives",[]),e.module("qualitaCoreFrontend.filters",[]),e.module("qualitaCoreFrontend.services",[]),e.module("qualitaCoreFrontend",["qualitaCoreFrontend.config","qualitaCoreFrontend.directives","qualitaCoreFrontend.filters","qualitaCoreFrontend.services","ngResource","ngCookies","ngSanitize","ngTouch","datatables","datatables.bootstrap","schemaForm","pascalprecht.translate","cgNotify","angular-underscore/filters","flow","ui.bootstrap","ui.select","ui.highlight","mgcrea.ngStrap.select","ncy-angular-breadcrumb","ui.router","oc.lazyLoad","ngStorage","LocalForageModule","datatables.buttons","datatables.colreorder","daterangepicker"])}(angular),angular.module("qualitaCoreFrontend").directive("fileupload",["$rootScope",function(e){return{template:'<div ng-show="form.uploadOptions.imageOnly"><div flow-init="{singleFile: true, target: form.uploadOptions.target}" flow-file-added="!!{png:1,gif:1,jpg:1,jpeg:1}[$file.getExtension()]"flow-files-submitted="form.uploader.flow.upload()"flow-files-added="filesAdded($files, $event, form.uploader.flow)"flow-name="form.uploader.flow"class="ng-scope"><h3>{{showTitle()}}</h3><div class="thumbnail" ng-show="form.uploader.currentFile && !form.uploader.flow.files.length"><img src="{{form.uploader.currentFile}}"/> </div><div class="thumbnail" ng-show="!form.uploader.flow.files.length && !form.uploader.currentFile"><img src="images/placeholder.png"></div><div class="thumbnail" ng-show="form.uploader.flow.files.length"><img flow-img="form.uploader.flow.files[0]"/> </div><div><span class="btn btn-primary" ng-show="!form.uploader.flow.files.length" flow-btn="">Seleccionar imagen<input type="file" sf-changed="form" ng-model="$$value$$" style="visibility: hidden; position: absolute;" /></span><span class="btn btn-info ng-hide" ng-show="form.uploader.flow.files.length" flow-btn="">Cambiar<input type="file" sf-changed="form" ng-model="$$value$$" style="visibility: hidden; position: absolute;" /></span><span class="btn btn-danger ng-hide" ng-show="form.uploader.flow.files.length" ng-click="form.uploader.flow.cancel()">Eliminar</span></div><p>Formatos permitidos: PNG, GIF, JPG y JPEG.</p></div></div><div ng-show="!form.uploadOptions.imageOnly"><div flow-init="{singleFile: true, target: form.uploadOptions.target}" flow-file-added="filesAdded($files, $event, uploader.flow)"flow-files-submitted="form.uploader.flow.upload()"flow-files-added="filesAdded($files, $event, form.uploader.flow)"flow-name="form.uploader.flow"class="ng-scope"><h3>{{showTitle()}}</h3><div class="drop" flow-drop ng-class="dropClass"><span class="btn btn-default" flow-btn>Cargar archivo<input type="file" ng-model="$$value$$" sf-changed="form" style="visibility: hidden; position: absolute;" /></span><b>OR</b>Arrastre el archivo aqu&iacute;</div><br/><div><div ng-repeat="file in form.uploader.flow.files" class="transfer-box">{{file.relativePath}} ({{file.size}}bytes)<div class="progress progress-striped" ng-class="{active: file.isUploading()}"><div class="progress-bar" role="progressbar"aria-valuenow="{{file.progress() * 100}}"aria-valuemin="0"aria-valuemax="100"NaN<span class="sr-only">{{file.progress()}}% Complete</span></div></div><div class="btn-group"><a class="btn btn-xs btn-danger" ng-click="file.cancel()">Cancelar</a><a class="btn btn-xs btn-info" ng-click="file.retry()" ng-show="file.error">Reintentar</a></div></div></div></div></div>',restrict:"E",tranclude:!0,scope:!0,link:function(t,n,o){t.uploader={},t.title=o.title,t.fileModel={},t.filesAdded=function(t,n,o){e.flow||(e.flow=o)}}}}]),angular.module("qualitaCoreFrontend").directive("offlineFormRecovery",function(e){return{template:'<div class="btn-group" role="group" aria-label="First group"><button ng-disabled="!pending.length || position == 0" type="button" class="glyphicon glyphicon-arrow-left btn btn-default btn-recovery" ng-click="previous()"></button><button ng-disabled="!pending.length || position == pending.length" type="button" class="glyphicon glyphicon-arrow-right btn btn-default btn-recovery" ng-click="next()"></button><button ng-disabled="!pending.length || position == 0" type="button" class="glyphicon glyphicon-remove btn btn-default btn-recovery" ng-click="remove()"></button></div>',restrict:"EA",link:function(t){t.position=0,e.getItem(t.resource).then(function(e){t.pending=_(e).filter(function(e){return!e.id}).map(function(e,t){return e.index=t,e}).value()}),t.next=function(){t.position++,t.model=0==t.position?{}:t.pending[t.position-1]},t.previous=function(){t.position--,t.model=0==t.position?{}:t.pending[t.position-1]},t.remove=function(){e.getItem(t.resource).then(function(n){t.pending=_.filter(n,function(e,n){return n!==t.position-1}),e.setItem(t.resource,t.pending),t.previous()})}}}}),angular.module("qualitaCoreFrontend").directive("reportViewer",["$modal","$sce",function(e,t){return{template:"",restrict:"E",scope:{url:"=",title:"@",background:"="},link:function(n,o){n.close=function(){n.modalInstance.dismiss("close")},n.$watch("url",function(){n.url&&(n.trustedUrl=t.trustAsResourceUrl(n.url),n.background?o.append('<iframe src="'+n.trustedUrl+'" hidden></iframe>'):n.modalInstance=e.open({template:'<div class="modal-header"><div class="close glyphicon glyphicon-remove" ng-click="close()"></div><h3 class="modal-title">{{title}}</h3></div><div class="modal-body"><iframe src="{{trustedUrl}}" width="100%" height="450"></iframe></div><div class="modal-footer"><button class="btn btn-primary" ng-click="close()">Cerrar</button></div>',scope:n}))})}}}]),angular.module("qualitaCoreFrontend").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,t,n){var o=function(t,o,r){if("string"===o.type&&"enum"in o){var i=e.stdFormObj(t,o,r);return i.key=r.path,i.type="strapselect",r.lookup[n.stringify(r.path)]=i,i}};e.defaults.string.unshift(o),t.addMapping("bootstrapDecorator","strapselect","views/directives/strapselect.html"),t.createDirective("strapselect","views/directives/strapselect.html"),t.addMapping("bootstrapDecorator","strapmultiselect","views/directives/strapmultiselect.html"),t.createDirective("strapmultiselect","views/directives/strapmultiselect.html"),t.addMapping("bootstrapDecorator","strapselectdynamic","views/directives/strapselect.html"),t.createDirective("strapselectdynamic","views/directives/strapselect.html"),t.addMapping("bootstrapDecorator","strapmultiselectdynamic","views/directives/strapmultiselect.html"),t.createDirective("strapmultiselectdynamic","views/directives/strapmultiselect.html"),t.addMapping("bootstrapDecorator","uiselect","views/directives/uiselect.html"),t.createDirective("uiselect","views/directives/uiselect.html"),t.addMapping("bootstrapDecorator","uiselectmultiple","views/directives/uiselectmultiple.html"),t.createDirective("uiselectmultiple","views/directives/uiselectmultiple.html")}]).directive("toggleSingleModel",function(){return{require:"ngModel",restrict:"A",scope:{},replace:!0,controller:["$scope",function(e){e.$parent.$watch("select_model.selected",function(){void 0!=e.$parent.select_model.selected&&(e.$parent.insideModel=e.$parent.select_model.selected.value,e.$parent.ngModel.$setViewValue(e.$parent.select_model.selected.value))})}]}}).directive("toggleModel",function(){return{require:"ngModel",restrict:"A",scope:{},controller:["$scope","sfSelect",function(e,t){var n=t(e.$parent.form.key,e.$parent.model);angular.isUndefined(n)&&(n=[],t(e.$parent.form.key,e.$parent.model,n)),e.$parent.$watch("form.selectedOptions",function(){e.$parent.form.selectedOptions&&(0==e.$parent.form.selectedOptions.length?void 0!=e.$parent.ngModel.$viewValue&&e.$parent.ngModel.$setViewValue(e.$parent.form.selectedOptions):(e.$parent.$$value$$=[],e.$parent.form.selectedOptions.forEach(function(t){e.$parent.$$value$$.push(t.value)}),e.$parent.ngModel.$setViewValue(e.$parent.$$value$$)))},!0)}]}}).directive("multipleOn",function(){return{link:function(e,t){e.$watch(function(){return t.attr("multiple-on")},function(e){if("true"==e){var n=angular.element(t).scope().$$childTail;n.$isMultiple=!0,n.options.multiple=!0,n.$select.$element.addClass("select-multiple")}else angular.element(t).scope().$$childTail.$isMultiple=!1})}}}).filter("whereMulti",function(){return function(e,t,n){var o=[];return angular.isArray(n)&&void 0!==e?n.forEach(function(n){for(var r=0;r<e.length;r++)if(n==e[r][t]){o.push(e[r]);break}}):o=e,o}}).filter("propsFilter",function(){return function(e,t){var n=[];return angular.isArray(e)?e.forEach(function(e){for(var o=!1,r=Object.keys(t),i=0;i<r.length;i++){var a=r[i];if(e.hasOwnProperty(a)){var l=t[a].toLowerCase();if(0===e[a].toString().toLowerCase().indexOf(l)||-1!==e[a].toString().toLowerCase().indexOf(" "+l)){o=!0;break}}}o&&n.push(e)}):n=e,n}}).filter("filterRelated",function(){return function(e,t){return"function"==typeof t.form.options.filterRelated?t.form.options.filterRelated(e):e}}),angular.module("qualitaCoreFrontend").controller("dynamicSelectController",["$scope","$http","$timeout",function(e,t,n){function o(t,n,o){var i=r(o),a=o.map;if(angular.isArray(i))return t;if(!i)return[{value:void 0,name:e.form.placeholder}].concat(t);for(var l=0;l<t.length&&t[l][a.valueProperty]!==i[a.valueProperty];l++);var s=t[0];return t[0]=t[l],t[l]=s,t}function r(t){var n=e.form,o=n.key[0],r=angular.element("form[name="+t.formName+"]").scope();return r.model[o]}function a(t,n){var o=r(n);e.select_model.selected={value:o,name:o}}e.select_model={},e.triggerTitleMap=function(){console.log("listener triggered"),e.form.titleMap.push({value:"345890u340598u3405u9",name:"34095u3p4ouij"}),n(function(){e.form.titleMap.pop()})},e.initFiltering=function(t){e.form.options.filterTriggers&&e.form.options.filterTriggers.forEach(function(t){e.$parent.$watch(t,e.triggerTitleMap)}),e.localModelType=Object.prototype.toString.call(t),e.filteringInitialized=!0},e.remap=function(e,t){if(e&&"map"in e&&e.map){var n=[];if(t.forEach(function(t){t.value=t[e.map.valueProperty],t.name=t[e.map.nameProperty],n.push(t)}),e.formName){var r=angular.element("form[name="+e.formName+"]").scope();n=o(t,r,e)}return n}return t.forEach(function(e){"text"in e&&(e.name=e.text)}),t},e.clone=function(t){if(null==t||"object"!=typeof t)return t;var n=t.constructor();for(var o in t)t.hasOwnProperty(o)&&(n[o]=e.clone(t[o]));return n},e.getCallback=function(t){if("string"==typeof t){var n=e.$parent.evalExpr(t);if("function"==typeof n)return n;throw"A callback string must match name of a function in the parent scope"}if("function"==typeof t)return t;throw"A callback must either be a string matching the name of a function in the parent scope or a direct function reference"},e.getOptions=function(t){return t.httpPost&&t.httpPost.optionsCallback?(newOptionInstance=e.clone(t),e.getCallback(t.httpPost.optionsCallback)(newOptionInstance)):t.httpGet&&t.httpGet.optionsCallback?(newOptionInstance=e.clone(t),e.getCallback(t.httpGet.optionsCallback)(newOptionInstance)):t},e.test=function(e){e.titleMap.pop()},e.populateTitleMap=function(n){if("enum"in n.schema)n.titleMap=[],n.schema.enum.forEach(function(e){n.titleMap.push({value:e,name:e})}),a(n.titleMap,n.options);else if(n.options)if(n.options.callback)n.titleMap=e.getCallback(n.options.callback)(n.options),console.log("callback items",n.titleMap);else{if(n.options.asyncCallback)return e.getCallback(n.options.asyncCallback)(n.options).then(function(t){n.titleMap=e.remap(n.options,t.data),n.options.multiple?e.uiMultiSelectInitInternalModel(r(n.options)):e.select_model.selected=n.titleMap[0],console.log("asyncCallback items",n.titleMap)},function(e,t){alert("Loading select items failed(Options: '"+String(n.options)+"\nError: "+t)});if(n.options.httpPost){var o=e.getOptions(n.options);return t.post(o.httpPost.url,o.httpPost.parameter).then(function(t){n.titleMap=e.remap(o,t.data),console.log("httpPost items",n.titleMap)},function(e,t){alert("Loading select items failed (URL: '"+String(o.httpPost.url)+"' Parameter: "+String(o.httpPost.parameter)+"\nError: "+t)})}if(n.options.httpGet){var o=e.getOptions(n.options);return t.get(o.httpGet.url,o.httpGet.parameter).then(function(t){n.titleMap=e.remap(o,t.data),console.log("httpGet items",n.titleMap)},function(e,t){alert("Loading select items failed (URL: '"+String(o.httpGet.url)+"\nError: "+t)})}}else console.log("dynamicSelectController.populateTitleMap(key:"+n.key+") : No options set, needed for dynamic selects")},e.uiMultiSelectInitInternalModel=function(t){function n(t){for(i=0;i<e.form.titleMap.length;i++)if(e.form.titleMap[i].value==t)return e.form.titleMap[i].name}e.internalModel=[],void 0!==t&&angular.isArray(t)&&t.forEach(function(t){e.internalModel.push({value:t,name:n(t)})})}}]),angular.module("qualitaCoreFrontend").filter("selectFilter",[function(){return function(e,t,n,o){if(!angular.isDefined(e)||!angular.isDefined(t.form.options)||!angular.isDefined(t.form.options.filter)||""==t.form.options.filter)return e;console.log("----- In filtering for "+t.form.key+"("+t.form.title+"), model value: "+JSON.stringify(n)+"----"),console.log("Filter:"+t.form.options.filter),t.filteringInitialized||(console.log("Initialize filter"),t.initFiltering(n));var r=[];return angular.forEach(e,function(e){console.log("Compare: curr_item: "+JSON.stringify(e)+"with : "+JSON.stringify(t.$eval(t.form.options.filterTriggers[0]))),t.$eval(t.form.options.filter,{item:e})?r.push(e):n&&("[object Array]"==t.localModelType&&n.indexOf(e.value)>-1?n.splice(n.indexOf(e.value),1):n==e.value&&(console.log("Setting model of type "+t.localModelType+"to null."),n=null))}),"[object Array]"!=t.localModelType||n||(console.log("Resetting model of type "+t.localModelType+" to []."),t.$eval(o+"=[]")),console.log("Input: "+JSON.stringify(e)),console.log("Output: "+JSON.stringify(r)),console.log("Model value out : "+JSON.stringify(n)),console.log("----- Exiting filter for "+t.form.title+"-----"),r}}]),angular.module("qualitaCoreFrontend").directive("tdnDatatable",function(e,t,n,o,r,i,a,l,s,c){var u=i.hasPermission;return{template:'<div><div class="widget"><div class="widget-header"><span class="widget-caption">{{options.title}}</span><div class="widget-buttons"><a href="#" ng-show="canCreate()" ng-click="new()" title="Nuevo"><i class="glyphicon glyphicon-plus"></i></a><a ng-repeat="menuOption in options.extraMenuOptions" href="#" ng-show="menuOption.showCondition()" ng-click="menuOption.action()" title="{{menuOption.title}}"><p><i class="{{menuOption.icon}}"></i>  {{menuOption.data}}&nbsp;&nbsp;&nbsp;</p></a></div></div><div class="widget-body"><div class="table-responsive"><table datatable="" dt-options="dtOptions" dt-columns="dtColumns" dt-instance="dtInstanceCallback" width=100% class="table table-striped no-footer"></table></div><div ng-if="selected"><h3>Detalles</h3><table class="table table-striped table-bordered table-detail"><tbody><tr ng-repeat="row in options.detailRows"><td ng-if="selected[row.data]" class="row-title">{{row.title}}</td><td ng-if="selected[row.data] && row.renderWith">{{row.renderWith(selected[row.data])}}</td><td ng-if="selected[row.data] && !row.renderWith">{{selected[row.data]}}</td></tr></tbody></table></div></div></div>',restrict:"AE",replace:!0,scope:{options:"="},controller:function(i){function d(t,n){return $("td",t).unbind("click"),$("td",t).bind("click",function(){i.$apply(function(){i.selected=n,e(function(){$(document).scrollTop($(".table-detail").offset().top)})})}),t}var p,f,m=_.template(s.getBaseUrl()+"/<%= resource %>/datatables?");i.dtInstance={},i.selectAll=!1,i.headerCompiled=!1,i.customFilters={};var g,h,v="~",b="DD/MM/YYYY",w="string",y=function(e,t){g&&_.forEach(g.colReorder.order(),function(t,n){e.columns[n].type=i.customFilters[t]?i.customFilters[t].filterType:w}),e.rangeSeparator=v;var n=r(m(i.options)+$.param(e),{},{query:{isArray:!1}});n.query().$promise.then(function(e){t(e)}).catch(function(e){console.log(e),console.log("error")})},O=i.options.ajax?i.options.ajax:y;i.dateRangeFilters={i:{startDate:null,endDate:null}};var C=function(e){var t=e.model.startDate.format(b),n=e.model.endDate.format(b),o=g.colReorder.order().indexOf(e.opts.index);g.column(o).search(t+v+n).draw()},k=function(e){var t=g.colReorder.order().indexOf(e.opts.index);g.column(t).search("").draw(),$("#daterange_"+e.opts.index).val(""),i.dateRangeFilters[e.opts.index].startDate=null,i.dateRangeFilters[e.opts.index].endDate=null},A=function(e){if(null===i.dateRangeFilters[e.opts.index].startDate){var t=i.dateRangePickerWidgetsOrder.indexOf(e.opts.index),n=$($(".daterangepicker").get(t));n.parent().find(".in-range").removeClass("in-range"),n.parent().find(".active").removeClass("active"),n.parent().find(".input-mini").removeClass("active").val("")}};moment.locale("es");var M={cancelLabel:"Limpiar",applyLabel:"Aplicar",format:b,separator:" a ",weekLabel:"S",daysOfWeek:moment.weekdaysMin(),monthNames:moment.monthsShort(),firstDay:moment.localeData().firstDayOfWeek()};i.dateRangeOptions={};var R={eventHandlers:{"apply.daterangepicker":C,"cancel.daterangepicker":k,"show.daterangepicker":A},opens:"right",index:0,showDropdowns:!0,locale:M};i.dateRangePickerWidgetsOrder=[],i.numberRangeFilters={},i.dtOptions=a.newOptions().withOption("ajax",O).withDataProp("data").withOption("processing",!0).withOption("serverSide",!0).withOption("order",[[i.options.defaultOrderColumn,i.options.defaultOrderDir]]).withOption("language",{sProcessing:"Procesando...",sLengthMenu:"Mostrar _MENU_ registros",sZeroRecords:"No se encontraron resultados",sEmptyTable:"Ningún dato disponible en esta tabla",sInfo:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",sInfoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",sInfoFiltered:"(filtrado de un total de _MAX_ registros)",sInfoPostFix:".",sSearch:"Buscar:",sInfoThousands:",",sLoadingRecords:"Cargando...",oPaginate:{sFirst:"Primero",sLast:"Último",sNext:"Siguiente",sPrevious:"Anterior"},oAria:{sSortAscending:": Activar para ordenar la columna de manera ascendente",sSortDescending:": Activar para ordenar la columna de manera descendente"}}).withOption("createdRow",function(e){n(angular.element(e).contents())(i)}).withOption("headerCallback",function(e){i.headerCompiled||(i.headerCompiled=!0,n(angular.element(e).contents())(i))}).withPaginationType("full_numbers").withButtons(["colvis"]).withBootstrap(),i.options.detailRows&&(i.dtOptions=i.dtOptions.withOption("rowCallback",d)),i.visibleColumns=0,i.dtColumns=[],i.defaultColumnOrderIndices=[],i.originalIndexKey={};var F=0;if(i.options.isSelectable){var P='<label><input type="checkbox" ng-model="selectAll" ng-click="toggleAll(selectAll)"><span class="text"></span></label>';f=l.newColumn(null).withTitle(P).notSortable().withOption("searchable",!1).renderWith(function(e){var t='<label><input id="'+e.id+'" type="checkbox" ng-model="$scope.options.selection['+e.id+']" ng-click="toggleOne($scope.options.selection)"><span class="text"></span></label>';return t}).withOption("name","checkbox"),i.dtColumns.push(f),i.visibleColumns+=1,F=1,i.originalIndexKey[0]=null,i.defaultColumnOrderIndices.push(0),i.dtOptions.withColReorderOption("iFixedColumnsLeft",1)}var T=["data","title","class","renderWith","visible","sortable"];_.map(i.options.columns,function(e,t){var n=l.newColumn(e.data),o=F+t;if(i.originalIndexKey[o]=e.data,e.title&&(n=n.withTitle(e.title)),e.class&&(n=n.withClass(e.class)),e.renderWith&&(n=n.renderWith(e.renderWith)),e.sortable===!1&&(n=n.notSortable()),_.contains(i.options.defaultColumnOrder,e.data)&&e.visible!==!1?i.visibleColumns+=1:n=n.notVisible(),_.forOwn(e,function(e,t){_.contains(T,t)||(n=n.withOption(t,e))}),e.type){var r={filterType:e.type,filterUrl:e.filterUrl};"date-range"===e.type?i.dateRangeFilters[o]={startDate:null,endDate:null}:"number-range"===e.type&&(i.numberRangeFilters[o]={start:null,end:null}),i.customFilters[o]=r}i.dtColumns.push(n)}),i.options.hasOptions&&(i.originalIndexKey[i.visibleColumns]=null,i.dtOptions.withColReorderOption("iFixedColumnsRight",1),i.visibleColumns+=1),(i.options.colReorder===!0||void 0===i.options.colReorder)&&i.dtOptions.withColReorder(),p=l.newColumn(null).withTitle("Operaciones").notSortable().withOption("searchable",!1).renderWith(function(e){var t='<button class="btn btn-success btn-dt" style="margin-right: 5px;" ng-show="canEdit()" ng-click="edit('+e.id+')">   <span class="glyphicon glyphicon-pencil"></span></button><button class="btn btn-danger btn-dt" style="margin-right: 5px;" ng-show="canRemove()" ng-click="remove('+e.id+')">   <span class="glyphicon glyphicon-trash"></span></button>';return i.options.extraRowOptions&&_.forEach(i.options.extraRowOptions,function(n){var r=_.template(n.templateToRender);i[n.functionName]=n.functionDef,t+=r({dataCustom:e[n.customAttribute],dataId:e.id,$state:o,$scope:i})}),t}),i.canEdit=function(){return u("update_"+i.options.resource)},i.canRemove=function(){return u("delete_"+i.options.resource)},i.canCreate=function(){return u("create_"+i.options.resource)},i.options.hasOptions&&(i.dtColumns.push(p),i.visibleColumns+=1),i.new=function(){var e=_.template("app.<%= resource %>.new");o.go(e(i.options))},i.edit=function(e){var t=_.template("app.<%= resource %>.edit");o.go(t(i.options),{id:e})},i.toggleAll=function(){i.selectAll=i.selectAll?!0:!1,i.selectAll?_.each(g.rows().data(),function(e){i.options.selection[e.id]||$("#"+e.id).click()}):_.each(i.options.selection,function(e,t){e&&$("#"+t).click()})},i.toggleOne=function(e){for(var t in e)if(e.hasOwnProperty(t)&&!e[t])return i.selectAll=!1,void 0;var n=!0;_.each(g.rows().data(),function(e){i.options.selection[e.id]||(n=!1)}),i.selectAll=n,i.options.selection=e};var x=function(e){return e.descripcion},I=function(e){return""===e.descripcion?'<div class="select2-user-result">Todos</div>':'<div class="select2-user-result">'+e.descripcion+"</div>"},S=function(){$("#"+h+" tfoot tr").empty(),i.dateRangePickerWidgetsOrder=[],$(".daterangepicker").remove(),_.forEach(g.context[0].aoColumns,function(e){var t=e._ColReorder_iOrigCol,o=(e.mData,"<th></th>");if(e.bVisible){var r=e.name;name||(r=e.sTitle);var a=i.customFilters[t];if(a){if("combo"===a.filterType){var l="combo_"+t;o='<th><div id="'+l+'" name="'+r+'" class="filtro-ancho"></div></th>',$("#"+h+" tfoot tr").append(o),o="",$("#"+l).select2({minimumResultsForSearch:-1,id:function(e){return e.codigo},data:function(){return $http({url:s.getBaseUrl()+a.filterUrl,method:"GET"})},ajax:{url:s.getBaseUrl()+"/"+a.filterUrl,dataType:"json",quietMillis:250,params:{headers:{Authorization:c.AuthParams.accessToken}},data:function(e){return{q:e}},results:function(e){return{results:e}},cache:!0},initSelection:function(e,t){$.ajax(s.getBaseUrl()+"/"+a.filterUrl,{dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization",c.AuthParams.accessToken)}}).done(function(e){t(e)})},formatResult:I,formatSelection:x,escapeMarkup:function(e){return e}}).on("change",function(){var e=($("#"+l).select2("val"),parseInt(l.substring(6))),t=g.colReorder.order().indexOf(e);console.log(this.value),this.value.length>=1?g.column(t).search(this.value).draw():g.column(t).search("").draw()})}else if("date-range"===a.filterType){i.dateRangeOptions[t]=_.clone(R,!0),i.dateRangeOptions[t].index=t,t>i.options.columns.length/2&&(i.dateRangeOptions[t].opens="left"),i.dateRangePickerWidgetsOrder.push[t];var u='<th><input readonly="true" id="daterange_'+t+'" date-range-picker placeholder="'+r+'" class="column-filter form-control input-sm date-picker" options="dateRangeOptions['+t+']" type="text" ng-model="dateRangeFilters['+t+']" /></th>';o=n(u)(i)}}else if(e.mData){var d=g.column(e.idx).search();o='<th><input id="filtro_'+t+'" class="column-filter form-control input-sm" type="text" placeholder="'+r+'" style="min-width:60px; width: 100%;" value="'+d+'"/></th>'}$("#"+h+" tfoot tr").append(o)}}),_.forEach($("[id^='filtro']"),function(e){$(e).on("keyup change",function(t){var n=parseInt(e.id.substring(7)),o=g.colReorder.order().indexOf(n);(this.value.length>=1||13==t.keyCode)&&g.column(o).search(this.value).draw(),""==this.value&&g.column(o).search("").draw()})})};i.dtOptions.withColReorderCallback(function(){var e=this.fnOrder();console.log("Columns order has been changed with: "+e),S()}),i.dtInstanceCallback=function(t){$("thead+tfoot").remove(),h=t.id,g=t.DataTable,$("#"+h).append("<tfoot><tr></tr></tfoot>"),S(),$("#"+h+" tfoot").insertAfter("#"+h+" thead"),_.each(i.dtColumns,function(e,t){if(e.filter){var n=$(".input-sm")[t+1];n.value=e.filter}}),$(".dt-buttons").append("<label class='view-columns'>Vistas&nbsp;</label>"),$(".dt-button").addClass("form-control input-sm").text("Columnas"),i.dtOptions.reloadData=function(){$("#"+h).DataTable().ajax.reload()},g.on("draw",function(){e(function(){var e=!0;_.each(g.rows().data(),function(t){i.options.selection[t.id]||(e=!1)}),i.selectAll=e})}),g.on("column-visibility",function(e,t,n,o){console.log("change column visibility %o",o),S()}),i.dtInstance=t,i.options.getFilters=function(){var e=$("#"+h).dataTable(),t=e.oApi._fnAjaxParameters(e.fnSettings()),n=$.param(t).split("data"),o={};return _.each(n,function(e){if(-1===e.indexOf("draw")){var t=e.substring(e.indexOf("=")+1,e.indexOf("&")),n=e.substring(e.indexOf("=",e.indexOf("value"))+1,e.indexOf("&",e.indexOf("value")));void 0!==t&&void 0!==n&&""!=t&&""!==n&&(o[t]=n)}}),o}},i.remove=function(e){i.selectedItemId=e,i.tituloModal="Confirmación de Borrado",i.mensajeModal="Esta operación eliminará el registro seleccionado. ¿Desea continuar?";var n=t.open({template:'<div class="modal-header"><h3 class="modal-title">{{::tituloModal}}</h3></div><div class="modal-body">{{::mensajeModal}}</div><div class="modal-footer"><button class="btn btn-primary" ng-click="ok(selectedItemId)">Aceptar</button><button class="btn btn-warning" ng-click="cancel()">Cancelar</button></div>',scope:i});i.cancel=function(){n.dismiss("cancel")},i.ok=function(e){var t=i.options.factory.create({id:e});i.options.factory.remove(t).then(function(){i.dtOptions.reloadData(),n.close(e)})}},i.options.detailRows&&(i.options.detailRows=i.options.detailRows===!0?i.options.columns:_.union(i.options.columns,i.options.detailRows))}}}),angular.module("qualitaCoreFrontend").service("AuthenticationService",function(e,t,n,o){var r=e(o.getBaseUrl()+"/:action",{action:"@action"});return{login:function(e,n){t.auxiliarUsername=e;var o=new r({username:e,password:n});return o.$save({action:"login"})},postLogin:function(e){return new r.save({action:"loginApp"},{username:e.username})},token:function(e){var t=new r({username:e.username,accessToken:e.accessToken,requestToken:e.requestToken});return t.$save({action:"token"})},logout:function(){var e=this.getCurrentUser(),n=new r({username:e.username,accessToken:e.accessToken});return t.AuthParams={},localStorage.removeItem("AUTH_PARAMS"),n.$save({action:"logout"})},getCurrentUser:function(){var e=t.AuthParams;return e&&0!==Object.keys(e).length||(e=JSON.parse(localStorage.getItem("AUTH_PARAMS"))||void 0,e&&(n.defaults.headers.common.Authorization="Bearer "+e.accessToken)),e}}}),angular.module("qualitaCoreFrontend").service("AuthorizationService",function(e,t,n,o,r){var i=t(o.getBaseUrl()+"/authorization/:action",{action:"@action"});return{hasPermission:function(e,t){var n=t||r.getCurrentUser(),o=[];return n&&(o=n.permissions||[]),o.indexOf(e)>=0},principal:function(){return i.get({action:"principal"}).$promise},setupCredentials:function(t,o,r,i){var a={username:t,requestToken:o,accessToken:r};e.AuthParams=a,localStorage.setItem("AUTH_PARAMS",JSON.stringify(a)),n.defaults.headers.common.Authorization="Bearer "+r,this.principal().then(function(e){a.permissions=e.permisos,a.stamp=e.stamp,localStorage.setItem("AUTH_PARAMS",JSON.stringify(a)),i(a)})},cleanupCredentials:function(){localStorage.removeItem("AUTH_PARAMS")},authorize:function(e,t){var n=r.getCurrentUser();if(e===!0&&void 0===n)return this.enums.LOGIN_REQUIRED;if(e&&void 0!==n&&(void 0===t||0===t.length))return this.enums.AUTHORIZED;if(t){for(var o=!0,i=0;i<t.length&&(o=this.hasPermission(t[i],n),o!==!1);i++);return o?this.enums.AUTHORIZED:this.enums.NOT_AUTHORIZED}},enums:{LOGIN_REQUIRED:"loginRequired",NOT_AUTHORIZED:"notAuthorized",AUTHORIZED:"authorized"}}}),angular.module("qualitaCoreFrontend").factory("baseurl",function(e){return{getBaseUrl:function(){var t=window.location.hostname;return t===e.serverIp?"http://"+t+"/"+e.serverName+"/"+e.serverAPI:"http://"+t+":"+e.serverPort+"/"+e.serverName+"/"+e.serverAPI},getPublicBaseUrl:function(){var t=window.location.hostname;return t===e.serverIp?"http://"+t+"/public/":"http://"+t+":"+e.serverPort+"/public/"}}}),angular.module("qualitaCoreFrontend").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider","flowFactoryProvider",function(e,t,n,o){o.defaults={method:"octet"};var r=function(t,o,r){if("object"===o.type&&"fileupload"===o.format){var i=e.stdFormObj(t,o,r);return i.key=r.path,i.type="fileupload",r.lookup[n.stringify(r.path)]=i,i}};e.defaults.object.unshift(r),t.addMapping("bootstrapDecorator","fileupload","views/directives/fileupload.html"),t.createDirective("fileupload","views/directives/fileupload.html")}]).factory("fileupload",function(){}),angular.module("qualitaCoreFrontend").factory("filterFactory",function(){var e=function(e,t){var r={_inner:{type:e}};return t.constructor!==Array&&(t=[t]),r._inner.filters=this&&this._inner?[this._inner,t]:t,r.or||"and"!==e||(r.or=n),r.value||(r.value=i),r.add||(r.add=o),r.paginate=a,r},t=function(t){return e.call(this,"and",t)},n=function(t){return e.call(this,"or",t)},o=function(e){return this._inner.filters.push(e),this},r=function(e){return t([e])},i=function(){return this._inner},a=function(e,t){return this._inner.limit=e,this._inner.offset=t,this};return{and:t,or:n,add:o,single:r,value:i}}),angular.module("qualitaCoreFrontend").factory("formFactory",function(e,t,n,o){return{defaultForm:function(){return["*",{type:"submit",title:"Guardar",htmlClass:"pull-right"}]},defaultOptions:function(){return{formDefaults:{ngModelOptions:{updateOn:"blur"}},validationMessage:{302:"El campo es obligatorio"}}},defaultSubmit:function(r,i,a,l,s){if(i.$broadcast("schemaFormValidate"),a.$valid){if(o.isProcessing=!0,i.model)var c=l.create(i.model);else var c=l.create(s.model);l.save(c).then(function(){o.isProcessing=!1,e.path("/"+r)},function(){o.isProcessing=!1;var e="Error al persistir la operación.";i.model.id||(e+="\n\nGuardando localmente, reintente más tarde."),n({message:e,classes:"alert-danger",position:"right"}),t.getItem(r).then(function(e){e=e||[],e.unshift(i.model),i.model.id||t.setItem(r,e)})})}}}}),angular.module("qualitaCoreFrontend").factory("HttpInterceptor",function(e,t,n,o,r){return{request:function(e){return"/login"!==t.path()&&(e.headers.Authorization="Bearer "+n.AuthParams.accessToken),e},requestError:function(n){return 401===n.status&&t.path("/login"),e.reject(n)},response:function(e){return e},responseError:function(o){var i=r.get("notify");if(401===o.status){if(o.data&&403===o.data.code)return i({message:o.data.error,classes:["alert-danger"]}),t.path("/"),e.reject(o);if("/login"===t.path())return e.reject(o);var a=e.defer(),l=r.get("AuthenticationService"),s=r.get("$http"),c=l.token(n.AuthParams);return c.then(function(e){n.AuthParams.accessToken=e.accessToken,localStorage.setItem("AUTH_PARAMS",JSON.stringify(n.AuthParams)),s.defaults.headers.common.Authorization="Bearer "+e.accessToken,l.postLogin(n.AuthParams).$promise.then(function(e){n.AuthParams.accesoSistema=e,s.defaults.headers.common["X-Access"]=n.AuthParams.accesoSistema.accesosSistema[0].locacion.id})}).then(a.resolve,a.reject),a.promise.then(function(){return o.config.headers.Authorization="Bearer "+n.AuthParams.accessToken,s(o.config)})}return e.reject(o)}}}),angular.module("qualitaCoreFrontend").factory("ReportTicketFactory",["$resource","baseurl",function(e,t){var n=e(t.getBaseUrl()+"/ticket/:reportID",{action:"@reportID"});
return{ticket:function(e,t){var o=new n(t);return o.$save({reportID:e})},downloadURL:function(e,n){return console.log("downloadURL"),t.getBaseUrl()+"/generar/"+e+"/"+n}}}]),angular.module("qualitaCoreFrontend").factory("usuariosFactory",function(e,t,n){var o=e(n.getBaseUrl()+"/usuarios/:id",{id:"@id"},{update:{method:"PUT"}});return{all:function(e){return o.query(e)},get:function(e){return o.get({id:e})},getByUsername:function(e){var n={};return n.search=t.single({path:"username",equals:e}).value(),o.query(n)},create:function(e){return new o(e)},save:function(e){return e.id?e.$update():e.$save()},remove:function(e){return e.$remove()}}});