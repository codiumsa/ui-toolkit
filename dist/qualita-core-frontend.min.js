function NotificacionesWSFactory(e,t,n,o){function r(e){return g.query(e)}function i(e){var t=!1;e&&(t=e),h.close(t)}function a(e){return new g(e)}function s(e){return g.get({id:e})}function l(e,t){var n={action:"get",offset:e,limit:t};h.send(JSON.stringify(n))}function c(e){h=o(t.getBareServerUrl()+"wsnotificaciones");var n={action:"init",username:e};h.onOpen(function(){console.log("Socket abierto")}),h.onClose(function(){console.log("Socket cerrado")}),console.log(h),h.send(JSON.stringify(n))}function d(e,t){var o={action:e,notificacion:t.id};n.info("mensaje a mandar: "),n.info(o),h.send(JSON.stringify(o))}function u(e){h||(h=o(t.getBareServerUrl()+"wsnotificaciones")),h.onMessage(e)}function p(e){return e.$remove()}function f(e){return e.id?e.$update():e.$save()}var m={all:r,close:i,create:a,get:s,getLatest:l,init:c,remove:p,save:f,sendAction:d,registerMessageObserver:u},g=e(t.getBaseUrl()+"/notificaciones/:id",{id:"@id"},{update:{method:"PUT"}}),h=void 0;return m}!function(e){e.module("qualitaCoreFrontend.config",[]).value("qualitaCoreFrontend.config",{debug:!0}),e.module("qualitaCoreFrontend.directives",[]),e.module("qualitaCoreFrontend.filters",[]),e.module("qualitaCoreFrontend.services",[]),e.module("qualitaCoreFrontend",["qualitaCoreFrontend.config","qualitaCoreFrontend.directives","qualitaCoreFrontend.filters","qualitaCoreFrontend.services","ngResource","ngCookies","ngSanitize","ngTouch","datatables","datatables.bootstrap","schemaForm","pascalprecht.translate","cgNotify","angular-underscore/filters","flow","ui.bootstrap","ui.select","ui.highlight","ncy-angular-breadcrumb","ui.router","oc.lazyLoad","ngStorage","LocalForageModule","datatables.buttons","datatables.colreorder","daterangepicker","rangepicker","ngWebSocket","pickadate"])}(angular),angular.module("qualitaCoreFrontend").controller("BasicController",["$rootScope","$scope","formFactory","$location","$state","$injector",function(e,t,n,o,r,i){function a(){if(!n.canCreate(t.resources)){var e=i.get("notify");e({message:"No tiene permiso de creación",classes:["alert-danger"],position:"right"}),o.path("/")}t.title=t.newProperties.title,t.form=t.factory.form("new"),t.model={}}function s(){if(!n.canEdit(t.resources)){var e=i.get("notify");e({message:"No tiene permiso de edición",classes:["alert-danger"],position:"right"}),o.path("/")}t.model=t.prepService,t.entidadId=t.model.id,t.entidad=t.editProperties.entidad,t.form=t.factory.form("edit"),t.title=t.editProperties.title}function l(){if(!n.canList(t.resources)){var e=i.get("notify");e({message:"No tiene permiso de vista",classes:["alert-danger"],position:"right"}),o.path("/")}t.model=t.prepService,t.entidadId=t.model.id,t.entidad=t.editProperties.entidad,t.form=t.factory.form("edit"),t.title=t.editProperties.title,t.view=!0,t.schema.readonly=!0}t.activate=function(){t.schema=t.factory.schema(),r.is(t.newProperties.state)?a():r.is(t.editProperties.state)?s():r.is(t.viewProperties.state)&&l(),t.options=n.defaultOptions(),e.isProcessing=!1},t.submit=function(e){n.defaultSubmit(t.resource,t,e,t.factory)},t.cancel=function(){o.path("/"+t.resource)}}]),angular.module("qualitaCoreFrontend").directive("fileupload",["$rootScope",function(e){return{template:'<div ng-show="uploadOptions.imageOnly"><div flow-init="{singleFile: true}" flow-files-submitted="uploader.flow.upload()"flow-file-added="!!{png:1,gif:1,jpg:1,jpeg:1}[$file.getExtension()]"flow-files-added="filesAdded($files, $event, uploader.flow)"flow-name="uploader.flow"class="ng-scope"><label>{{uploadOptions.title}}</label><div class="thumbnail" ng-show="uploader.currentFile && !uploader.flow.files.length"><img src="{{uploader.currentFile}}" style="max-width: 300px; max-height: 200px;"/> </div><div class="thumbnail" ng-show="!uploader.flow.files.length && !uploader.currentFile && !uploadOptions.imagePath"><img src="images/placeholder.png" style="max-width: 300px; max-height: 200px;"></div><div class="thumbnail" ng-show="uploader.flow.files.length"><img flow-img="uploader.flow.files[0]" style="max-width: 300px; max-height: 200px;"/> </div><div class="thumbnail" ng-show="uploadOptions.imagePath && !uploader.currentFile && !uploader.flow.files.length"><img ng-src="{{uploadOptions.imagePath}}" style="max-width: 300px; max-height: 200px;"/> </div><div><span class="btn btn-primary" ng-show="!uploader.flow.files.length" flow-btn="">Seleccionar imagen<input type="file" sf-changed="form" ng-model="$$value$$" style="visibility: hidden; position: absolute;" /></span><span class="btn btn-info ng-hide" ng-show="uploader.flow.files.length" flow-btn="">Cambiar<input type="file" sf-changed="form" ng-model="$$value$$" style="visibility: hidden; position: absolute;" /></span><span class="btn btn-danger ng-hide" ng-show="uploader.flow.files.length" ng-click="uploader.flow.cancel()">Eliminar</span></div><p>Formatos permitidos: PNG, GIF, JPG y JPEG.</p></div></div><div ng-show="!uploadOptions.imageOnly"><div flow-init="{singleFile: true, target: form.uploadOptions.target}" flow-file-added="filesAdded($files, $event, uploader.flow)"flow-files-submitted="form.uploader.flow.upload()"flow-files-added="filesAdded($files, $event, form.uploader.flow)"flow-name="form.uploader.flow"class="ng-scope"><h3>{{showTitle()}}</h3><div class="drop" flow-drop ng-class="dropClass"><span class="btn btn-default" flow-btn>Cargar archivo<input type="file" ng-model="$$value$$" sf-changed="form" style="visibility: hidden; position: absolute;" /></span><b>OR</b>Arrastre el archivo aqu&iacute;</div><br/><div><div ng-repeat="file in form.uploader.flow.files" class="transfer-box">{{file.relativePath}} ({{file.size}}bytes)<div class="progress progress-striped" ng-class="{active: file.isUploading()}"><div class="progress-bar" role="progressbar"aria-valuenow="{{file.progress() * 100}}"aria-valuemin="0"aria-valuemax="100"NaN<span class="sr-only">{{file.progress()}}% Complete</span></div></div><div class="btn-group"><a class="btn btn-xs btn-danger" ng-click="file.cancel()">Cancelar</a><a class="btn btn-xs btn-info" ng-click="file.retry()" ng-show="file.error">Reintentar</a></div></div></div></div></div>',restrict:"E",tranclude:!0,scope:!0,link:function(t,n,o){t.uploader={},t.title=o.title,t.fileModel={},t.filesAdded=function(t,n,o){e.flow||(e.flow=o)}}}}]),angular.module("qualitaCoreFrontend").directive("offlineFormRecovery",function(e){return{template:'<div class="btn-group" role="group" aria-label="First group"><button ng-disabled="!pending.length || position == 0" type="button" class="glyphicon glyphicon-arrow-left btn btn-default btn-recovery" ng-click="previous()"></button><button ng-disabled="!pending.length || position == pending.length" type="button" class="glyphicon glyphicon-arrow-right btn btn-default btn-recovery" ng-click="next()"></button><button ng-disabled="!pending.length || position == 0" type="button" class="glyphicon glyphicon-remove btn btn-default btn-recovery" ng-click="remove()"></button></div>',restrict:"EA",link:function(t){t.position=0,t.resource?e.getItem(t.resource).then(function(e){t.pending=_(e).filter(function(e){return!e.id}).map(function(e,t){return e.index=t,e}).value()}):console.log("scope.resource no definido"),t.next=function(){t.position++,t.model=0==t.position?{}:t.pending[t.position-1]},t.previous=function(){t.position--,t.model=0==t.position?{}:t.pending[t.position-1]},t.remove=function(){e.getItem(t.resource).then(function(n){t.pending=_.filter(n,function(e,n){return n!==t.position-1}),e.setItem(t.resource,t.pending),t.previous()})}}}}),angular.module("qualitaCoreFrontend").directive("reportViewer",["$modal","$sce",function(e,t){return{template:"",restrict:"E",scope:{url:"=",title:"@",background:"="},link:function(n,o){n.close=function(){n.modalInstance.dismiss("close")},n.$watch("url",function(){n.url&&(n.trustedUrl=t.trustAsResourceUrl(n.url),n.background?o.append('<iframe src="'+n.trustedUrl+'" hidden></iframe>'):n.modalInstance=e.open({template:'<div class="modal-header"><div class="close glyphicon glyphicon-remove" ng-click="close()"></div><h3 class="modal-title">{{title}}</h3></div><div class="modal-body"><iframe src="{{trustedUrl}}" width="100%" height="450"></iframe></div><div class="modal-footer"><button class="btn btn-primary" ng-click="close()">Cerrar</button></div>',scope:n}))})}}}]),angular.module("qualitaCoreFrontend").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider",function(e,t,n){var o=function(t,o,r){if("string"===o.type&&"enum"in o){var i=e.stdFormObj(t,o,r);return i.key=r.path,i.type="strapselect",r.lookup[n.stringify(r.path)]=i,i}};e.defaults.string.unshift(o),t.addMapping("bootstrapDecorator","strapselect","views/directives/strapselect.html"),t.createDirective("strapselect","views/directives/strapselect.html"),t.addMapping("bootstrapDecorator","strapmultiselect","views/directives/strapmultiselect.html"),t.createDirective("strapmultiselect","views/directives/strapmultiselect.html"),t.addMapping("bootstrapDecorator","strapselectdynamic","views/directives/strapselect.html"),t.createDirective("strapselectdynamic","views/directives/strapselect.html"),t.addMapping("bootstrapDecorator","strapmultiselectdynamic","views/directives/strapmultiselect.html"),t.createDirective("strapmultiselectdynamic","views/directives/strapmultiselect.html"),t.addMapping("bootstrapDecorator","uiselect","views/directives/uiselect.html"),t.createDirective("uiselect","views/directives/uiselect.html"),t.addMapping("bootstrapDecorator","uiselectmultiple","views/directives/uiselectmultiple.html"),t.createDirective("uiselectmultiple","views/directives/uiselectmultiple.html")}]).directive("toggleSingleModel",function(){return{require:"ngModel",restrict:"A",scope:{},replace:!0,controller:["$scope",function(e){e.$parent.$watch("select_model.selected",function(){void 0!=e.$parent.select_model.selected&&(e.$parent.insideModel=e.$parent.select_model.selected.value,e.$parent.ngModel.$setViewValue(e.$parent.select_model.selected.value))})}]}}).directive("toggleModel",function(){return{require:"ngModel",restrict:"A",scope:{},controller:["$scope","sfSelect",function(e,t){var n=t(e.$parent.form.key,e.$parent.model);angular.isUndefined(n)&&(n=[],t(e.$parent.form.key,e.$parent.model,n)),e.$parent.$watch("form.selectedOptions",function(){e.$parent.form.selectedOptions&&(0==e.$parent.form.selectedOptions.length?void 0!=e.$parent.ngModel.$viewValue&&e.$parent.ngModel.$setViewValue(e.$parent.form.selectedOptions):(e.$parent.$$value$$=[],e.$parent.form.selectedOptions.forEach(function(t){e.$parent.$$value$$.push(t.value)}),e.$parent.ngModel.$setViewValue(e.$parent.$$value$$)))},!0)}]}}).directive("multipleOn",function(){return{link:function(e,t){e.$watch(function(){return t.attr("multiple-on")},function(e){if("true"==e){var n=angular.element(t).scope().$$childTail;n.$isMultiple=!0,n.options.multiple=!0,n.$select.$element.addClass("select-multiple")}else angular.element(t).scope().$$childTail.$isMultiple=!1})}}}).filter("whereMulti",function(){return function(e,t,n){var o=[];return angular.isArray(n)&&void 0!==e?n.forEach(function(n){for(var r=0;r<e.length;r++)if(n==e[r][t]){o.push(e[r]);break}}):o=e,o}}).filter("propsFilter",function(){return function(e,t){var n=[];return angular.isArray(e)?e.forEach(function(e){for(var o=!1,r=Object.keys(t),i=0;i<r.length;i++){var a=r[i];if(e.hasOwnProperty(a)){var s=t[a].toLowerCase();if(e[a]&&(0===e[a].toString().toLowerCase().indexOf(s)||-1!==e[a].toString().toLowerCase().indexOf(" "+s))){o=!0;break}}}o&&n.push(e)}):n=e,n}}).filter("filterRelated",function(){return function(e,t){return"function"==typeof t.form.options.filterRelated?t.form.options.filterRelated(e):e}}),angular.module("qualitaCoreFrontend").controller("dynamicSelectController",["$scope","$http","$timeout",function(e,t,n){function o(t,n,o){var i=r(o),a=o.map;if(angular.isArray(i))return t;if(!i)return[{value:void 0,name:e.form.placeholder}].concat(t);for(var s=0;s<t.length&&t[s][a.valueProperty]!==i[a.valueProperty];s++);var l=t[0];return t[0]=t[s],t[s]=l,t}function r(t){var n=e.form,o=n.key[0],r=angular.element("form[name="+t.formName+"]").scope();return r.model[o]}function a(t,n){var o=r(n);e.select_model.selected={value:o,name:o}}e.select_model={},e.triggerTitleMap=function(){console.log("listener triggered"),e.form.titleMap.push({value:"345890u340598u3405u9",name:"34095u3p4ouij"}),n(function(){e.form.titleMap.pop()})},e.initFiltering=function(t){e.form.options.filterTriggers&&e.form.options.filterTriggers.forEach(function(t){e.$parent.$watch(t,e.triggerTitleMap)}),e.localModelType=Object.prototype.toString.call(t),e.filteringInitialized=!0},e.remap=function(e,t){if(e&&"map"in e&&e.map){var n=[];if(t.forEach(function(t){t.value=t[e.map.valueProperty],t.name=t[e.map.nameProperty],n.push(t)}),e.formName){var r=angular.element("form[name="+e.formName+"]").scope();n=o(t,r,e)}return n}return t.forEach(function(e){"text"in e&&(e.name=e.text)}),t},e.clone=function(t){if(null==t||"object"!=typeof t)return t;var n=t.constructor();for(var o in t)t.hasOwnProperty(o)&&(n[o]=e.clone(t[o]));return n},e.getCallback=function(t){if("string"==typeof t){var n=e.$parent.evalExpr(t);if("function"==typeof n)return n;throw"A callback string must match name of a function in the parent scope"}if("function"==typeof t)return t;throw"A callback must either be a string matching the name of a function in the parent scope or a direct function reference"},e.getOptions=function(t){return t.httpPost&&t.httpPost.optionsCallback?(newOptionInstance=e.clone(t),e.getCallback(t.httpPost.optionsCallback)(newOptionInstance)):t.httpGet&&t.httpGet.optionsCallback?(newOptionInstance=e.clone(t),e.getCallback(t.httpGet.optionsCallback)(newOptionInstance)):t},e.test=function(e){e.titleMap.pop()},e.populateTitleMap=function(n){if("enum"in n.schema)n.titleMap=[],n.schema.enum.forEach(function(e){n.titleMap.push({value:e,name:e})}),a(n.titleMap,n.options);else if(n.options)if(n.options.callback)n.titleMap=e.getCallback(n.options.callback)(n.options),console.log("callback items",n.titleMap);else{if(n.options.asyncCallback)return e.getCallback(n.options.asyncCallback)(n.options).then(function(t){n.titleMap=e.remap(n.options,t.data),n.options.multiple?e.uiMultiSelectInitInternalModel(r(n.options)):e.select_model.selected=n.titleMap[0],console.log("asyncCallback items",n.titleMap)},function(e,t){alert("Loading select items failed(Options: '"+String(n.options)+"\nError: "+t)});if(n.options.httpPost){var o=e.getOptions(n.options);return t.post(o.httpPost.url,o.httpPost.parameter).then(function(t){n.titleMap=e.remap(o,t.data),console.log("httpPost items",n.titleMap)},function(e,t){alert("Loading select items failed (URL: '"+String(o.httpPost.url)+"' Parameter: "+String(o.httpPost.parameter)+"\nError: "+t)})}if(n.options.httpGet){var o=e.getOptions(n.options);return t.get(o.httpGet.url,o.httpGet.parameter).then(function(t){n.titleMap=e.remap(o,t.data),console.log("httpGet items",n.titleMap)},function(e,t){alert("Loading select items failed (URL: '"+String(o.httpGet.url)+"\nError: "+t)})}}else console.log("dynamicSelectController.populateTitleMap(key:"+n.key+") : No options set, needed for dynamic selects")},e.uiMultiSelectInitInternalModel=function(t){function n(t){for(i=0;i<e.form.titleMap.length;i++)if(e.form.titleMap[i].value==t)return e.form.titleMap[i].name}e.internalModel=[],void 0!==t&&angular.isArray(t)&&t.forEach(function(t){e.internalModel.push({value:t,name:n(t)})})}}]),angular.module("qualitaCoreFrontend").filter("selectFilter",[function(){return function(e,t,n,o){if(!angular.isDefined(e)||!angular.isDefined(t.form.options)||!angular.isDefined(t.form.options.filter)||""==t.form.options.filter)return e;console.log("----- In filtering for "+t.form.key+"("+t.form.title+"), model value: "+JSON.stringify(n)+"----"),console.log("Filter:"+t.form.options.filter),t.filteringInitialized||(console.log("Initialize filter"),t.initFiltering(n));var r=[];return angular.forEach(e,function(e){console.log("Compare: curr_item: "+JSON.stringify(e)+"with : "+JSON.stringify(t.$eval(t.form.options.filterTriggers[0]))),t.$eval(t.form.options.filter,{item:e})?r.push(e):n&&("[object Array]"==t.localModelType&&n.indexOf(e.value)>-1?n.splice(n.indexOf(e.value),1):n==e.value&&(console.log("Setting model of type "+t.localModelType+"to null."),n=null))}),"[object Array]"!=t.localModelType||n||(console.log("Resetting model of type "+t.localModelType+" to []."),t.$eval(o+"=[]")),console.log("Input: "+JSON.stringify(e)),console.log("Output: "+JSON.stringify(r)),console.log("Model value out : "+JSON.stringify(n)),console.log("----- Exiting filter for "+t.form.title+"-----"),r}}]),angular.module("qualitaCoreFrontend").directive("tdnDatatable",function(e,t,n,o,r,i,a,s,l,c){var d=i.hasPermission;return{template:'<div><div class="widget"><div class="widget-header bordered-top bordered-palegreen"><span class="widget-caption">{{options.title}}</span><div class="widget-buttons"><a href="#" ng-show="canCreate()" ng-click="new()" title="Nuevo"><i class="glyphicon glyphicon-plus"></i></a><a ng-repeat="menuOption in options.extraMenuOptions" href="" ng-show="menuOption.showCondition()" ng-click="menuOption.action()" title="{{menuOption.title}}"><p><i class="{{menuOption.icon}}"></i>  {{menuOption.data}}&nbsp;&nbsp;&nbsp;</p></a></div></div><div class="widget-body"><div class="table-responsive"><table datatable="" dt-options="dtOptions" dt-columns="dtColumns" dt-instance="dtInstanceCallback" width=100% class="table table-striped no-footer"></table></div><div ng-if="selected"><h3>Detalles</h3><table class="table table-striped table-bordered table-detail"><tbody><tr ng-repeat="row in options.detailRows"><td ng-if="selected[row.data]" class="row-title">{{row.title}}</td><td ng-if="selected[row.data] && row.renderWith">{{row.renderWith(selected[row.data])}}</td><td ng-if="selected[row.data] && !row.renderWith">{{selected[row.data]}}</td></tr></tbody></table></div></div></div>',restrict:"AE",replace:!0,scope:{options:"="},controller:function(i){function u(t,n){return $("td",t).unbind("click"),$("td",t).bind("click",function(){i.$apply(function(){i.selected=n,e(function(){$(document).scrollTop($(".table-detail").offset().top)})})}),t}var p,f,m;m=i.options.staticFilter?_.template(l.getBaseUrl()+"/<%= resource %>/datatables?search="+encodeURI(JSON.stringify(i.options.staticFilter.search))+"&"):_.template(l.getBaseUrl()+"/<%= resource %>/datatables?"),i.dtInstance={},i.selectAll=!1,i.options.selection={},i.headerCompiled=!1,i.customFilters={};var g,h,v="~",b="DD/MM/YYYY",w="string",y=function(e,t){g&&_.forEach(g.colReorder.order(),function(t,n){e.columns[n].type=i.customFilters[t]?i.customFilters[t].filterType:w}),e.rangeSeparator=v;var n=r(m(i.options)+$.param(e),{},{query:{isArray:!1}});n.query().$promise.then(function(e){var n=e.data;n&&n.forEach(function(e){Object.keys(e).forEach(function(t){e[t]===!0?e[t]="Sí":e[t]===!1&&(e[t]="No")})}),t(e)}).catch(function(e){console.log(e),console.log("error")})},O=i.options.ajax?i.options.ajax:y;i.dateRangeFilters={i:{startDate:null,endDate:null}};var k=function(e){var t=e.model.startDate.format(b),n=e.model.endDate.format(b),o=g.colReorder.order().indexOf(e.opts.index);g.column(o).search(t+v+n).draw()},C=function(e){var t=g.colReorder.order().indexOf(e.opts.index);g.column(t).search("").draw(),$("#daterange_"+e.opts.index).val(""),i.dateRangeFilters[e.opts.index].startDate=null,i.dateRangeFilters[e.opts.index].endDate=null},A=function(e){if(null===i.dateRangeFilters[e.opts.index].startDate){var t=i.dateRangePickerWidgetsOrder.indexOf(e.opts.index),n=$($(".daterangepicker").get(t));n.parent().find(".in-range").removeClass("in-range"),n.parent().find(".active").removeClass("active"),n.parent().find(".input-mini").removeClass("active").val("")}};moment.locale("es");var R={cancelLabel:"Limpiar",applyLabel:"Aplicar",format:b,separator:" a ",weekLabel:"S",daysOfWeek:moment.weekdaysMin(),monthNames:moment.monthsShort(),firstDay:moment.localeData().firstDayOfWeek()};i.dateRangeOptions={};var x={eventHandlers:{"apply.daterangepicker":k,"cancel.daterangepicker":C,"show.daterangepicker":A},opens:"right",index:0,showDropdowns:!0,locale:R};i.dateRangePickerWidgetsOrder=[],i.numberRangeFilters={i:{startRange:null,endRange:null}};var F=function(e){var t=e.model.startRange,n=e.model.endRange,o=g.colReorder.order().indexOf(e.opts.index);g.column(o).search(t+v+n).draw()},P=function(e){var t=g.colReorder.order().indexOf(e.opts.index);g.column(t).search("").draw(),$("#numberrange_"+e.opts.index).val(""),i.numberRangeFilters[e.opts.index].startRange=null,i.numberRangeFilters[e.opts.index].endRange=null;var n=i.rangePickerWidgetsOrder.indexOf(e.opts.index),o=$($(".rangepicker").get(n));o.parent().find("input[name=rangepicker_start]").val(),o.parent().find("input[name=rangepicker_end]").val()},M={cancelLabel:"Limpiar",applyLabel:"Aplicar",separator:" a "};i.rangeOptions={};var S={eventHandlers:{"apply.rangepicker":F,"cancel.rangepicker":P},opens:"right",index:0,showDropdowns:!0,locale:M};i.rangePickerWidgetsOrder=[],i.dtOptions=a.newOptions().withOption("ajax",O).withDataProp("data").withOption("processing",!0).withOption("serverSide",!0).withOption("order",[i.options.defaultOrderColumn,i.options.defaultOrderDir]).withOption("language",{sProcessing:"Procesando...",sLengthMenu:"Registros _MENU_",sZeroRecords:"No se encontraron resultados",sEmptyTable:"Ningún dato disponible en esta tabla",sInfo:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",sInfoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",sInfoFiltered:"(filtrado de un total de _MAX_ registros)",sInfoPostFix:".",sSearch:"Buscar:",sInfoThousands:",",sLoadingRecords:"Cargando...",oPaginate:{sFirst:"Primero",sLast:"Último",sNext:"Siguiente",sPrevious:"Anterior"},oAria:{sSortAscending:": Activar para ordenar la columna de manera ascendente",sSortDescending:": Activar para ordenar la columna de manera descendente"}}).withOption("createdRow",function(e){n(angular.element(e).contents())(i)}).withOption("headerCallback",function(e){i.headerCompiled||(i.headerCompiled=!0,n(angular.element(e).contents())(i))}).withPaginationType("full_numbers").withButtons(["colvis"]).withBootstrap(),i.options.detailRows&&(i.dtOptions=i.dtOptions.withOption("rowCallback",u)),i.visibleColumns=0,i.dtColumns=[],i.defaultColumnOrderIndices=[],i.originalIndexKey={};var I=0;if(i.options.isSelectable){var T='<label><input type="checkbox" ng-model="selectAll" ng-click="toggleAll()"><span class="text"></span></label>';f=s.newColumn(null).withTitle(T).notSortable().withOption("searchable",!1).renderWith(function(e){var t='<label><input id="'+e.id+'" type="checkbox" ng-model="options.selection['+e.id+']" ng-click="toggleOne()"><span class="text"></span></label>';return t}).withOption("name","checkbox"),i.dtColumns.push(f),i.visibleColumns+=1,I=1,i.originalIndexKey[0]=null,i.defaultColumnOrderIndices.push(0),i.dtOptions.withColReorderOption("iFixedColumnsLeft",1)}var D=["data","title","class","renderWith","visible","sortable"];_.map(i.options.columns,function(e,t){var n=s.newColumn(e.data),o=I+t;if(i.originalIndexKey[o]=e.data,e.title&&(n=n.withTitle(e.title)),e.class&&(n=n.withClass(e.class)),e.renderWith&&(n=n.renderWith(e.renderWith)),e.sortable===!1&&(n=n.notSortable()),_.contains(i.options.defaultColumnOrder,e.data)&&e.visible!==!1?i.visibleColumns+=1:n=n.notVisible(),_.forOwn(e,function(e,t){_.contains(D,t)||(n=n.withOption(t,e))}),e.type){var r={filterType:e.type,filterUrl:e.filterUrl};"date-range"===e.type?i.dateRangeFilters[o]={startDate:null,endDate:null}:"number-range"===e.type&&(i.numberRangeFilters[o]={startRange:null,endRange:null}),i.customFilters[o]=r}i.dtColumns.push(n)}),i.options.hasOptions&&(i.originalIndexKey[i.visibleColumns]=null,i.dtOptions.withColReorderOption("iFixedColumnsRight",1),i.visibleColumns+=1),(i.options.colReorder===!0||void 0===i.options.colReorder)&&i.dtOptions.withColReorder(),p=s.newColumn(null).withTitle("Operaciones").notSortable().withOption("searchable",!1).renderWith(function(e){var t='<button class="btn btn-success btn-dt" style="margin-right: 5px;" ng-class="{ hidden : !canEdit()}" ng-click="edit('+e.id+')">   <span class="glyphicon glyphicon-pencil"></span></button><button class="btn btn-danger btn-dt" style="margin-right: 5px;" ng-class="{ hidden : !canRemove()}" ng-click="remove('+e.id+')">   <span class="glyphicon glyphicon-trash"></span></button><button class="btn btn-info btn-dt" style="margin-right: 5px;" ng-class="{ hidden : !canList()}" ng-click="view('+e.id+')">   <span class="glyphicon glyphicon-eye-open"></span></button>';return i.options.extraRowOptions&&_.forEach(i.options.extraRowOptions,function(n){var r=_.template(n.templateToRender);i[n.functionName]=n.functionDef,t+=r({dataCustom:JSON.stringify(e[n.customAttribute]),dataId:e.id,$state:o,$scope:i}),i[n.conditionName]=n.conditionDef}),t}),i.canEdit=function(){var e=d("update_"+i.options.resource);return e&&!i.options.hideEditMenu},i.canRemove=function(){var e=d("delete_"+i.options.resource);return e&&!i.options.hideRemoveMenu},i.canCreate=function(){var e=d("create_"+i.options.resource);return e&&!i.options.hideAddMenu},i.canList=function(){var e=d("index_"+i.options.resource);return e&&!i.options.hideViewMenu},i.options.hasOptions&&(i.dtColumns.push(p),i.visibleColumns+=1),i.new=function(){var e=_.template("app.<%= resource %>.new");o.go(e(i.options))},i.edit=function(e){var t=_.template("app.<%= resource %>.edit");o.go(t(i.options),{id:e})},i.view=function(e){var t=_.template("app.<%= resource %>.view");o.go(t(i.options),{id:e})},i.toggleAll=function(){i.selectAll?_.each(g.rows().data(),function(e){i.options.selection[e.id]=!0}):_.each(g.rows().data(),function(e){i.options.selection[e.id]=!1})},i.toggleOne=function(){var e=_.some(g.rows().data(),function(e){return!i.options.selection[e.id]});i.selectAll=!e};var E=function(e){return e.descripcion},U=function(e){return""===e.descripcion?'<div class="select2-user-result">Todos</div>':'<div class="select2-user-result">'+e.descripcion+"</div>"},N=function(){$("#"+h+" tfoot tr").empty(),i.dateRangePickerWidgetsOrder=[],$(".daterangepicker").remove(),_.forEach(g.context[0].aoColumns,function(e){var t=e._ColReorder_iOrigCol,o=(e.mData,"<th></th>");if(e.bVisible){var r=e.name;name||(r=e.sTitle);var a=i.customFilters[t];if(a){if("combo"===a.filterType){var s="combo_"+t;o='<th><div id="'+s+'" name="'+r+'" class="filtro-ancho"></div></th>',$("#"+h+" tfoot tr").append(o),o="",$("#"+s).select2({minimumResultsForSearch:-1,id:function(e){return e.descripcion},data:function(){return $http({url:l.getBaseUrl()+a.filterUrl,method:"GET"})},ajax:{url:l.getBaseUrl()+"/"+a.filterUrl,dataType:"json",quietMillis:250,params:{headers:{Authorization:c.AuthParams.accessToken}},data:function(e){return{q:e}},results:function(e){return{results:e}},cache:!0},initSelection:function(t,n){g.column(e.idx).search();$.ajax(l.getBaseUrl()+"/"+a.filterUrl,{dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization",c.AuthParams.accessToken)}}).done(function(e){n(e)})},formatResult:U,formatSelection:E,escapeMarkup:function(e){return e}}).on("change",function(){var e=($("#"+s).select2("val"),parseInt(s.substring(6))),t=g.colReorder.order().indexOf(e);this.value.length>=1?g.column(t).search(this.value).draw():g.column(t).search("").draw()})}else if("date-range"===a.filterType){i.dateRangeOptions[t]=_.clone(x,!0),i.dateRangeOptions[t].index=t,t>i.options.columns.length/2&&(i.dateRangeOptions[t].opens="left"),i.dateRangePickerWidgetsOrder.push[t];var d='<th><input id="daterange_'+t+'" date-range-picker class="column-filter form-control input-sm date-picker" options="dateRangeOptions['+t+']" type="text" ng-model="dateRangeFilters['+t+']" /></th>';o=n(d)(i)}else if("number-range"===a.filterType){i.rangeOptions[t]=_.clone(S,!0),i.rangeOptions[t].index=t,t>i.options.columns.length/2&&(i.rangeOptions[t].opens="left"),i.rangePickerWidgetsOrder.push[t];var d='<th><input  id="numberrange_'+t+'" range-picker class="column-filter form-control input-sm " options="rangeOptions['+t+']" type="text" ng-model="numberRangeFilters['+t+']" /></th>';o=n(d)(i)}}else if(e.mData){var u=g.column(e.idx).search();o='<th><input id="filtro_'+t+'" class="column-filter form-control input-sm" type="text" style="min-width:60px; width: 100%;" value="'+u+'"/></th>'}$("#"+h+" tfoot tr").append(o)}}),_.forEach($("[id^='filtro']"),function(e){$(e).on("keyup change",function(t){var n=parseInt(e.id.substring(7)),o=g.colReorder.order().indexOf(n);(this.value.length>=1||13==t.keyCode)&&g.column(o).search(this.value).draw(),""==this.value&&g.column(o).search("").draw()})})};i.dtOptions.withColReorderCallback(function(){this.fnOrder();N()}),i.dtInstanceCallback=function(t){$("thead+tfoot").remove(),h=t.id,g=t.DataTable,$("#"+h).append("<tfoot><tr></tr></tfoot>"),N(),$("#"+h+" tfoot").insertAfter("#"+h+" thead"),_.each(i.dtColumns,function(e,t){if(e.filter){var n=$(".input-sm")[t+1];n.value=e.filter}}),$(".dt-button.buttons-colvis").removeClass().addClass("columns-selection").html('<i class="glyphicon glyphicon-th-list"></i>'),i.dtOptions.reloadData=function(){$("#"+h).DataTable().ajax.reload()},g.on("draw",function(){e(function(){if(g.rows().data().length>0){var e=!0;_.each(g.rows().data(),function(t){void 0===i.options.selection[t.id]?(i.options.selection[t.id]=!1,e=!1):0==i.options.selection[t.id]&&(e=!1)}),i.selectAll=e}else i.selectAll=!1})}),g.on("column-visibility",function(){N()}),i.dtInstance=t,i.options.getFilters=function(){var e={};return _.forEach(g.context[0].aoColumns,function(t){var n=t._ColReorder_iOrigCol,o=t.mData;void 0!==o&&""!==o&&null!==o&&(e[o]=g.column(n).search())}),e}},i.remove=function(e){i.disableButton=!1,i.selectedItemId=e,i.tituloModal="Confirmación de Borrado",i.mensajeModal="Esta operación eliminará el registro seleccionado. ¿Desea continuar?",i.modalInstanceBorrar1=t.open({template:'<div class="modal-header"><h3 class="modal-title">{{::tituloModal}}</h3></div><div class="modal-body">{{::mensajeModal}}</div><div class="modal-footer"><button class="btn btn-primary" ng-disabled="disableButton" ng-click="ok(selectedItemId)">Aceptar</button><button class="btn btn-warning" ng-disabled="disableButton" ng-click="cancel()">Cancelar</button></div>',scope:i}),i.cancel=function(){i.disableButton=!0,i.modalInstanceBorrar1.dismiss("cancel")},i.ok=function(e){i.disableButton=!0;var n=i.options.factory.create({id:e});i.options.factory.remove(n).then(function(){i.dtOptions.reloadData(),i.modalInstanceBorrar1.close(e)},function(e){i.modalInstanceBorrar1.dismiss("cancel"),i.tituloModal="No se pudo borrar el registro",i.mensajeModal=i.options.failedDeleteError;var n=t.open({template:'<div class="modal-header"><h3 class="modal-title">{{::tituloModal}}</h3></div><div class="modal-body">{{::mensajeModal}}</div><div class="modal-footer"><button class="btn btn-primary" ng-click="cancel()">Aceptar</button></div>',scope:i});i.cancel=function(){n.dismiss("cancel")},console.log("error al borrar: "),console.log(e)})}},i.options.detailRows&&(i.options.detailRows=i.options.detailRows===!0?i.options.columns:_.union(i.options.columns,i.options.detailRows))}}}),angular.module("qualitaCoreFrontend").service("AuthenticationService",function(e,t,n,o){var r=e(o.getBaseUrl()+"/:action",{action:"@action"});return{login:function(e,n){t.auxiliarUsername=e;var o=new r({username:e,password:n});return o.$save({action:"login"})},postLogin:function(e){return new r.save({action:"loginApp"},{username:e.username})},token:function(e){var t=new r({username:e.username,accessToken:e.accessToken,requestToken:e.requestToken});return t.$save({action:"token"})},logout:function(){var e=this.getCurrentUser(),n=new r({username:e.username,accessToken:e.accessToken});return t.AuthParams={},localStorage.removeItem("AUTH_PARAMS"),n.$save({action:"logout"})},getCurrentUser:function(){var e=t.AuthParams;
return e&&0!==Object.keys(e).length||(e=JSON.parse(localStorage.getItem("AUTH_PARAMS"))||void 0,e&&(n.defaults.headers.common.Authorization="Bearer "+e.accessToken)),e}}}),angular.module("qualitaCoreFrontend").service("AuthorizationService",function(e,t,n,o,r){var i=t(o.getBaseUrl()+"/authorization/:action",{action:"@action"});return{hasPermission:function(e,t){var n=t||r.getCurrentUser(),o=[];return n&&(o=n.permissions||[]),o.indexOf(e)>=0},principal:function(){return i.get({action:"principal"}).$promise},setupCredentials:function(t,o,r,i){var a={username:t,requestToken:o,accessToken:r};e.AuthParams=a,localStorage.setItem("AUTH_PARAMS",JSON.stringify(a)),n.defaults.headers.common.Authorization="Bearer "+r,this.principal().then(function(e){a.permissions=e.permisos,a.stamp=e.stamp,localStorage.setItem("AUTH_PARAMS",JSON.stringify(a)),i(a)})},cleanupCredentials:function(){localStorage.removeItem("AUTH_PARAMS")},authorize:function(e,t){var n=r.getCurrentUser();if(e===!0&&void 0===n)return this.enums.LOGIN_REQUIRED;if(e&&void 0!==n&&(void 0===t||0===t.length))return this.enums.AUTHORIZED;if(t){for(var o=!0,i=0;i<t.length&&(o=this.hasPermission(t[i],n),o!==!1);i++);return o?this.enums.AUTHORIZED:this.enums.NOT_AUTHORIZED}},enums:{LOGIN_REQUIRED:"loginRequired",NOT_AUTHORIZED:"notAuthorized",AUTHORIZED:"authorized"}}}),angular.module("qualitaCoreFrontend").provider("baseurl",function(){this.config={},this.setConfig=function(e){this.config=e},this.$get=function(){var e=this.config;return{getBaseUrl:function(){var t=window.location.hostname;return t===e.serverIp?"http://"+t+"/"+e.serverName+"/"+e.serverAPI:"http://"+t+":"+e.serverPort+"/"+e.serverName+"/"+e.serverAPI},getPublicBaseUrl:function(){var t=window.location.hostname;return t===e.serverIp?"http://"+t+"/public/":"http://"+t+":"+e.serverPort+"/"+e.serverName+"/public/"},getBareServerUrl:function(){var t=window.location.hostname;return t===e.serverIp?"ws://"+t+"/"+e.serverWSName+"/":"ws://"+t+":"+e.serverPort+"/"+e.serverName+"/"}}}}),angular.module("qualitaCoreFrontend").config(["schemaFormProvider","schemaFormDecoratorsProvider","sfPathProvider","flowFactoryProvider",function(e,t,n,o){o.defaults={method:"octet"};var r=function(t,o,r){if("object"===o.type&&"fileupload"===o.format){var i=e.stdFormObj(t,o,r);return i.key=r.path,i.type="fileupload",r.lookup[n.stringify(r.path)]=i,i}};e.defaults.object.unshift(r),t.addMapping("bootstrapDecorator","fileupload","views/directives/fileupload.html"),t.createDirective("fileupload","views/directives/fileupload.html")}]).factory("fileupload",function(){}),angular.module("qualitaCoreFrontend").factory("filterFactory",function(){var e=function(e,t){var r={_inner:{type:e}};return t.constructor!==Array&&(t=[t]),r._inner.filters=this&&this._inner?[this._inner,t]:t,r.or||"and"!==e||(r.or=n),r.value||(r.value=i),r.add||(r.add=o),r.paginate=a,r},t=function(t){return e.call(this,"and",t)},n=function(t){return e.call(this,"or",t)},o=function(e){return this._inner.filters.push(e),this},r=function(e){return t([e])},i=function(){return this._inner},a=function(e,t){return this._inner.limit=e,this._inner.offset=t,this};return{and:t,or:n,add:o,single:r,value:i}}),angular.module("qualitaCoreFrontend").factory("formFactory",function(e,t,n,o,r,i){var a=r.hasPermission;return{defaultForm:function(){return["*",{type:"submit",title:"Guardar",htmlClass:"pull-right"}]},defaultOptions:function(){return{formDefaults:{ngModelOptions:{updateOn:"blur"}},validationMessage:{302:"El campo es obligatorio"}}},defaultSubmit:function(r,i,a,s,l,c){var d=[];if(_.each(a.$error,function(e,t){_.contains(i.schema.backEndValidatedErrors,t)&&_.each(e,function(e){var n="schemaForm.error."+e.$name;d.push(n),console.log("schemaForm.error."+e.$name+" error: "+t),i.$broadcast(n,t.toString(),!0,!0)}),_.each(d,function(e,t){console.log(e+" error: "+t),i.$broadcast(e,"schemaForm",!0,!0)})}),i.$broadcast("schemaFormValidate"),a.$valid&&!o.isProcessing){if(o.isProcessing=!0,i.model)var u=s.create(i.model);else var u=s.create(l.model);if(i.schema)var p=i.schema;else var p=l.schema;_.each(p.properties,function(e,t){!e.format||"date"!==e.format&&"date-time"!==e.format||u[t]&&"string"==typeof u[t]&&(u[t]=new moment(u[t],e.formatDate||"DD/MM/YYYY").toDate())}),s.save(u).then(function(){e.path("/"+r)}).catch(function(e){if(console.log(e),o.isProcessing=!1,c)return c(e),void 0;if(i.schema)var a=i.schema;else var a=l.schema;if(_.each(a.properties,function(e,t){!e.format||"date"!==e.format&&"date-time"!==e.format||i.model[t]&&i.model[t]instanceof Date&&(i.model[t]=currentForm[t].$viewValue)}),e.constructor===Array&&e.data[0].constraint&&i.$broadcast("schemaForm.error."+e.data[0].constraint,e.data[0].codigoError.toString(),!1),e.data&&403!==e.data.code){var s="Error al persistir la operación.";i.model.id||(s+="\n\nGuardando localmente, reintente más tarde."),n({message:s,classes:"alert-danger",position:"right"}),t.getItem(r).then(function(e){e=e||[],e.unshift(i.model),i.model.id||t.setItem(r,e)})}else if(e&&500===e.status){var s="";_.forEach(e.data,function(e){s+="\n\n"+e.message+"."}),n({message:s,classes:"alert-danger",position:"right"}),deferred.reject(s)}})}},defaultNSFSubmit:function(e,t,r,a){var s=i.defer();if(e.$valid&&!o.isProcessing){o.isProcessing=!0;var l=t.create(r);t.save(l).then(function(e){s.resolve(e)}).catch(function(e){if(console.log(e),o.isProcessing=!1,a)a(e),s.reject(t);else if(e&&500===e.status){var t="";_.forEach(e.data,function(e){t+="\n\n"+e.message+"."}),n({message:t,classes:"alert-danger",position:"right"}),s.reject(t)}})}return s.promise},canEdit:function(e){var t=a("update_"+e);return t},canList:function(e){var t=a("index_"+e);return t},canRemove:function(e){var t=a("delete_"+e);return t},canCreate:function(e){var t=a("create_"+e);return t}}}),angular.module("qualitaCoreFrontend").factory("HttpInterceptor",function(e,t,n,o,r){return{request:function(e){return"/login"!==t.path()&&(e.headers.Authorization="Bearer "+n.AuthParams.accessToken),e},requestError:function(n){return 401===n.status&&t.path("/login"),e.reject(n)},response:function(e){return e},responseError:function(o){console.log("responseError 401");var i=r.get("notify");if(401===o.status){if(o.data&&403===o.data.code)return i({message:o.data.error,classes:["alert-danger"],position:"right"}),t.path("/"),e.reject(o);if("/login"===t.path())return e.reject(o);var a=e.defer(),s=r.get("AuthenticationService"),l=r.get("$http"),c=s.token(n.AuthParams);return c.then(function(e){n.AuthParams.accessToken=e.accessToken,localStorage.setItem("AUTH_PARAMS",JSON.stringify(n.AuthParams)),l.defaults.headers.common.Authorization="Bearer "+e.accessToken,s.postLogin(n.AuthParams).$promise.then(function(e){n.AuthParams.accesoSistema=e,console.log("se ejecutó el response error"),l.defaults.headers.common["X-Access"]=n.AuthParams.accesoSistema.accesosSistema[0].locacion.id})}).then(a.resolve,a.reject),a.promise.then(function(){return o.config.headers.Authorization="Bearer "+n.AuthParams.accessToken,l(o.config)})}return e.reject(o)}}}),angular.module("qualitaCoreFrontend").factory("NotificacionesWSFactory",NotificacionesWSFactory),NotificacionesWSFactory.$inject=["$resource","baseurl","$log","$websocket"],angular.module("qualitaCoreFrontend").factory("ReportTicketFactory",["$resource","baseurl",function(e,t){var n=e(t.getBaseUrl()+"/ticket/:reportID",{action:"@reportID"});return{ticket:function(e,t){var o=new n(t);return o.$save({reportID:e})},downloadURL:function(e,n){return console.log("downloadURL"),t.getBaseUrl()+"/generar/"+e+"/"+n}}}]),angular.module("qualitaCoreFrontend").factory("usuariosFactory",function(e,t,n){var o=e(n.getBaseUrl()+"/usuarios/:id",{id:"@id"},{update:{method:"PUT"}});return{all:function(e){return o.query(e)},get:function(e){return o.get({id:e})},getByUsername:function(e){var n={};return n.search=t.single({path:"username",equals:e}).value(),o.query(n)},create:function(e){return new o(e)},save:function(e){return e.id?e.$update():e.$save()},remove:function(e){return e.$remove()}}});